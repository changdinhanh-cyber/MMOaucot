<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>MMO - Mua Tài Khoản</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* Định nghĩa biến màu sắc */
        :root {
            --primary-bg-color: #f0f0f0; 
            --navbar-bg-color: #ffffff;
            --topbar-bg-color: #ffffff;
            --text-color: #333;
            --accent-color: #007bff; 
            --success-color: #28a745; 
            --active-bg-color: #e0e0e0;
            --chat-color: #ff6600; 
            --support-color: #00bcd4; /* Màu xanh ngọc cho Support/Chat */
            --mmo-bg-dark: #222; 
            --wallet-glow: #00c6ff; /* Màu xanh cho hiệu ứng ví */
            --wallet-dark-bg: #1a1a1a; /* Nền tối cho ví */
            --highlight-yellow: #fff59d; /* Vàng kim */
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--primary-bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- THANH TRÊN CÙNG (TOP BAR) --- */
        .top-bar {
            background-color: var(--topbar-bg-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        /* Phần Tên Website: MMO Gradient (ĐÃ LÀM NỔI BẬT) */
        .website-name-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 5px 10px;
            border-radius: 8px;
            overflow: hidden;
            z-index: 1;
        }

        .website-name-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--mmo-bg-dark);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: -1;
        }

        .website-name {
            font-size: 2.2em; /* Tăng kích thước */
            font-weight: 900;
            letter-spacing: 3px; /* Tăng khoảng cách */
            text-transform: uppercase;
            
            background: linear-gradient(90deg, #ff00cc, #3333ff, #00ffcc, #ff00cc);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            
            animation: gradient-animation 4s ease infinite;

            text-shadow: 0px 0px 10px rgba(255,255,255,0.9); /* Tăng độ nổi bật */
            position: relative;
            z-index: 1;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Biểu tượng trái đất phía sau */
        .globe-icon {
            position: absolute;
            font-size: 3.5em;
            color: rgba(255, 255, 255, 0.1);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
        }

        /* Server và Số dư (CẤP ĐỘ PREMIUM VÀ THU GỌN SERVER) */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0;
        }
        
        .server-status, .balance {
            font-size: 0.8em; /* Đã thu nhỏ font */
            display: flex;
            align-items: center;
            padding: 6px 10px; /* Đã thu nhỏ padding */
            border-radius: 6px; 
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Server Status (Xanh Dương - Premium Look) */
        .server-status {
            background-color: #f0f4ff; 
            color: var(--accent-color);
            border-color: rgba(0, 123, 255, 0.3);
            font-weight: 700;
        }
        
        .server-status:hover {
            background-color: #e6f0ff;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Balance (Tối - Gold Glow Look) */
        .balance {
            background: linear-gradient(145deg, var(--wallet-dark-bg), #333); 
            color: white;
            border-color: rgba(255, 215, 0, 0.5); 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        
        .balance:hover {
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.5); 
            transform: translateY(-1px);
        }

        /* Biểu tượng trong Balance */
        .balance i {
            color: var(--highlight-yellow); 
            margin-right: 6px; /* Đã thu nhỏ margin */
            font-size: 1.1em;
        }
        
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
            flex-shrink: 0;
            box-shadow: 0 0 5px var(--success-color); 
        }
        .status-dot.active {
            background-color: var(--success-color);
        }
        .flag {
            font-size: 1.2em;
            margin-right: 5px;
        }
        
        /* --- THÔNG BÁO NỔI GÓC TRÊN BÊN PHẢI (PROMO) --- */
        .floating-notification-wrapper {
             position: fixed;
             top: 95px; 
             right: 20px;
             z-index: 990;
             max-width: 350px; 
        }
        
        .floating-notification {
            background: linear-gradient(45deg, #ff0077, var(--chat-color), #ff9933); 
            background-size: 200% 100%;
            animation: gradient-flow 4s ease infinite;

            color: white;
            padding: 12px 15px; 
            border-radius: 12px;
            border: 3px solid #fff; 
            
            box-shadow: 0 6px 15px rgba(255, 0, 119, 0.6), 0 0 20px rgba(255, 102, 0, 0.8); 
            
            display: flex;
            align-items: center;
            justify-content: space-between;
            
            opacity: 0;
            transform: translateX(100%) rotateX(90deg); 
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            
            position: relative;
            overflow: hidden;
        }

        .floating-notification::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1); 
            transform: rotate(30deg);
            z-index: 0;
            transition: background 0.5s;
        }

        .floating-notification:hover::after {
            background: rgba(255, 255, 255, 0.2);
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .floating-notification.show {
            opacity: 1;
            transform: translateX(0) rotateX(0deg);
        }
        
        .notification-icon {
            font-size: 1.5em; 
            margin-right: 12px;
            animation: bell-shake 1.5s ease-in-out infinite;
            color: #fff;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 1;
        }
        
        .notification-text {
            line-height: 1.3;
            z-index: 1;
        }
        
        .notification-text strong {
            font-weight: 900;
            color: var(--highlight-yellow); 
            text-shadow: 0 0 5px rgba(0,0,0,0.7);
            z-index: 1;
        }
        
        /* Nút xem chi tiết */
        .notification-action {
             background-color: rgba(255, 255, 255, 0.2);
             padding: 5px 10px;
             border-radius: 6px;
             margin-left: 15px;
             font-size: 0.9em;
             white-space: nowrap;
             border: 1px solid rgba(255, 255, 255, 0.5);
             transition: background-color 0.2s;
             z-index: 1;
        }
        
        .notification-action:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }

        @keyframes bell-shake {
            0%, 100% { transform: rotate(0); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(10deg); }
            40% { transform: rotate(-10deg); }
            50% { transform: rotate(0); }
            100% { transform: rotate(0); }
        }
        /* --- END PROMO NOTIFICATION --- */
        
        /* --- THÔNG BÁO TOAST NỔI BẬT (ĐÃ SỬA VỊ TRÍ) --- */
        #toast-notification {
            visibility: hidden;
            min-width: 250px;
            max-width: 320px;
            /* Vị trí cố định: Dưới cùng, bên phải (trên Navbar) */
            position: fixed;
            z-index: 3000; 
            right: 20px; /* Căn lề phải 20px */
            bottom: 85px; /* Cao hơn Navbar và Floating Buttons */
            
            background-color: #fff3e0; /* Nền màu cam nhạt */
            color: var(--text-color);
            text-align: left;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--chat-color);
            
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            opacity: 0;
            transform: translateX(100%) scale(0.9);
            transform-origin: bottom right; /* Bật ra từ góc dưới phải */
        }
        #toast-notification.show {
            visibility: visible;
            opacity: 1;
            transform: translateX(0) scale(1);
        }
        .toast-content {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            font-size: 0.95em;
        }
        .toast-icon {
            font-size: 1.4em;
            color: var(--chat-color); /* Icon giỏ hàng màu cam */
            margin-right: 10px;
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse { 0% { opacity: 0.7; } 100% { opacity: 1; } }
        /* --- END TOAST NOTIFICATION --- */

        /* --- WELCOME MODAL STYLES (Cảnh báo & Sự kiện) --- */
        #welcome-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Nền mờ/tối */
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Căn chỉnh hiện lên từ phía dưới */
            z-index: 5000; /* Cao hơn tất cả các modal khác */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #welcome-modal.show {
            visibility: visible;
            opacity: 1;
        }

        .welcome-content {
            background: linear-gradient(180deg, #fffaf0, #ffffff); /* Nền sáng, ấm */
            color: var(--text-color);
            padding: 25px 25px 15px 25px; 
            width: 95%;
            max-width: 600px; /* Chiều rộng vừa đủ */
            border-radius: 12px 12px 0 0; 
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.4);
            transform: translateY(100%); /* Bắt đầu ẩn dưới màn hình */
            transition: transform 0.4s ease-out;
            position: relative;
        }

        #welcome-modal.show .welcome-content {
            transform: translateY(0);
        }

        .welcome-header {
            display: flex;
            align-items: center;
            border-bottom: 2px solid var(--chat-color); 
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .welcome-header h4 {
            margin: 0;
            font-size: 1.3em;
            color: var(--chat-color);
            font-weight: 900;
        }
        
        .welcome-header i {
            font-size: 1.8em;
            color: red;
            margin-right: 10px;
            animation: warning-flash 1s infinite alternate;
        }

        .alert-section p, .event-section p {
            font-size: 0.95em;
            line-height: 1.4;
            margin: 8px 0;
        }

        .alert-section strong {
            color: red;
            font-weight: bold;
        }
        
        .event-section {
            padding-top: 10px;
            border-top: 1px dashed #ddd;
            margin-top: 15px;
        }
        
        .event-section h5 {
            color: var(--accent-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .event-section ul {
            padding-left: 20px;
            font-size: 0.9em;
        }
        .event-section ul li {
            margin-bottom: 5px;
        }

        .btn-understood {
            background-color: var(--chat-color);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em; /* Kích thước to */
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.5);
            transition: background-color 0.2s, transform 0.2s;
        }

        .btn-understood:hover {
            background-color: #e65c00;
            transform: translateY(-2px);
        }

        @keyframes warning-flash {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.1); }
        }
        /* --- END WELCOME MODAL STYLES --- */


        /* [GIỮ NGUYÊN CÁC CSS CÒN LẠI] */
        .sales-ticker-wrapper {
            position: sticky;
            top: 50px; 
            width: 100%;
            height: 30px;
            background-color: rgba(255, 255, 255, 0.95); 
            overflow: hidden; 
            z-index: 900;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .sales-ticker-content {
            white-space: nowrap;
            display: inline-block;
            font-size: 0.9em;
            font-weight: bold;
            color: var(--mmo-bg-dark);
            padding-left: 100%; 
            animation: ticker-move var(--ticker-speed) linear infinite;
        }

        .ticker-item {
            display: inline-block;
            padding: 0 30px;
        }

        .ticker-item i {
            color: var(--success-color);
            margin-right: 5px;
            animation: pulse 1.5s infinite; 
        }
        
        .ticker-highlight {
            color: var(--chat-color); 
        }

        @keyframes ticker-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }
        
        .content {
            padding: 0;
            max-width: 1200px;
            margin: 0 auto 70px auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            flex-grow: 1;
        }
        .section {
            padding: 20px;
        }

        .navbar {
            background-color: var(--navbar-bg-color);
            overflow: hidden;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
        }
        .navbar-list {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: space-around;
            max-width: 1200px;
            margin: 0 auto;
        }
        .navbar-item {
            text-align: center;
            flex-grow: 1;
        }
        .navbar-item a {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
            text-align: center;
            padding: 8px 10px;
            text-decoration: none;
            font-weight: normal;
            transition: all 0.2s ease-in-out;
            border-top: 2px solid transparent;
            font-size: 0.8em;
        }
        .navbar-icon {
            font-size: 1.4em;
            margin-bottom: 3px;
            line-height: 1;
        }
        .navbar-item a:hover {
            background-color: var(--primary-bg-color);
            color: var(--accent-color);
            font-weight: bold;
            transform: translateY(-2px);
            box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
            border-top-color: var(--accent-color);
        }
        .navbar-item a.active {
            background-color: var(--active-bg-color);
            color: var(--accent-color);
            font-weight: bold;
            border-top: 2pt solid var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 -4px 8px rgba(0,0,0,0.15);
        }

        .menu-homepage { padding: 20px; }
        .card { background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; }
        .card-header { display: flex; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--primary-bg-color); padding-bottom: 10px; }
        .card-header i { font-size: 1.5em; color: var(--accent-color); margin-right: 10px; }
        .card-header h4 { margin: 0; font-size: 1.1em; color: var(--text-color); }
        .event-banner { background: linear-gradient(135deg, var(--chat-color), #ff9933); color: white; padding: 25px; margin: -20px -20px 25px -20px; text-align: center; box-shadow: 0 6px 12px rgba(255, 102, 0, 0.4); border-radius: 8px 8px 0 0; }
        
        .event-banner.animated {
            background: linear-gradient(135deg, var(--chat-color), #ff9933, #ff0077, var(--chat-color)); 
            background-size: 300% 100%; 
            animation: 
                gradient-shift 8s ease infinite, 
                border-pulse 2s infinite alternate; 
            border: 3px solid transparent;
            box-shadow: 0 6px 15px rgba(255, 102, 0, 0.6); 
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes border-pulse {
            0% { border-color: rgba(255, 255, 255, 0.5); }
            100% { border-color: white; }
        }

        .event-banner.animated h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        .event-banner.animated p {
            font-weight: bold;
            font-size: 1.1em;
            animation: text-flash 4s ease-in-out infinite; 
        }

        @keyframes text-flash {
            0%, 100% { color: white; }
            50% { color: var(--highlight-yellow); }
        }
        
        .product-detail-item h5 {
            color: var(--mmo-bg-dark);
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .product-detail-item ul {
            list-style: disc;
            padding-left: 20px;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .product-detail-item ul.contact-list li {
            list-style: none;
            margin-bottom: 8px;
            padding-left: 0;
        }
        .product-detail-item ul li {
            margin-bottom: 3px;
        }
        
        .btn-primary { background-color: white; color: var(--chat-color); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        .btn-link { color: var(--accent-color); text-decoration: none; font-weight: bold; display: block; margin-top: 15px; transition: color 0.2s; }
        .product-highlight ul { list-style: none; padding: 0; margin: 0; }
        .product-highlight ul li { padding: 8px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; align-items: center; font-size: 0.95em; }
        .product-highlight ul li:last-child { border-bottom: none; }
        .price-tag { background-color: var(--success-color); color: white; padding: 2px 8px; border-radius: 12px; font-weight: bold; font-size: 0.9em; }
        .account-summary { background-color: var(--active-bg-color); border: 1px solid #ddd; }
        .instruction-card ol, .instruction-card ul { padding-left: 20px; margin: 0; font-size: 0.9em; }
        .instruction-card ol li, .instruction-card ul li { margin-bottom: 8px; }
        @media (min-width: 768px) {
            .grid-container { display: flex; gap: 20px; }
            .main-column { flex: 2; }
            .sidebar-column { flex: 1; }
            .card .grid-container {
                 display: flex;
                 flex-direction: row;
                 gap: 20px;
            }
        }

        .shop-page { 
            padding-top: 0; 
            padding-bottom: 20px; 
        }

        .shop-header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 30px 20px 40px 20px; 
            background: linear-gradient(135deg, #ff0077, #ff9933, #ff00cc); 
            color: white; 
            box-shadow: 0 8px 20px rgba(255, 0, 119, 0.4); 
            clip-path: polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%); 
            margin-top: -20px; 
            margin-left: -20px;
            margin-right: -20px;
            animation: header-fade-in 1s ease-out; 
            position: relative;
            overflow: hidden;
        }
        
        .shop-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIj48ZmlsdGVyIGlkPSJuIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iLjUiIG51bU9jdGF2ZXM9IjIiIHN0aXRjaFRpbGVzPSJub1N0aXRjaCIvPjwvZmlsdGVyPjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDApIi8+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbHRlcj0idXJsKCNuKSIgb3BhY2l0eT0iMC4wNSIvPjwvc3ZnPg==');
            opacity: 0.8;
            z-index: 1;
        }

        .shop-header h1 { 
            color: white; 
            font-size: 2.2em; 
            font-weight: 900;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            margin: 0;
            position: relative;
            z-index: 2;
        }
        
        .shop-header p {
            font-size: 1em;
            margin-top: 10px;
            opacity: 0.9;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
            position: relative;
            z-index: 2;
        }
        
        .shop-header h1 span {
            display: inline-block;
            animation: text-pop 0.5s ease-out both;
        }
        .shop-header h1 span:nth-child(2) { animation-delay: 0.1s; }
        .shop-header h1 span:nth-child(3) { animation-delay: 0.2s; }
        .shop-header h1 span:nth-child(4) { animation-delay: 0.3s; }

        @keyframes text-pop {
            0% { transform: translateY(-10px) scale(0.9); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes header-fade-in {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
        .product-card { background-color: var(--navbar-bg-color); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease; border: 1px solid #eee; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); }
        .card-icon { font-size: 2.5em; color: var(--accent-color); margin-bottom: 10px; padding: 15px; background-color: var(--primary-bg-color); border-radius: 50%; display: inline-block; }
        .product-title { font-size: 1.3em; color: var(--mmo-bg-dark); margin: 10px 0 5px 0; }
        .product-description { color: #666; font-size: 0.9em; height: 36px; margin-bottom: 15px; }
        .product-info { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 15px; margin-bottom: 15px; }
        .stock { font-size: 0.85em; color: var(--success-color); font-weight: bold; }
        .price { font-size: 1.2em; color: var(--chat-color); font-weight: 900; }
        .buy-button { background-color: var(--accent-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: background-color 0.2s; }
        .buy-button:hover { background-color: #0056b3; }
        .highlight-card { background: linear-gradient(135deg, #fff8e1, #fff); border: 3px solid var(--chat-color); box-shadow: 0 10px 30px rgba(255, 102, 0, 0.2); }
        .highlight-card .card-icon { color: #ffd700; background-color: #fff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .highlight-stock { color: var(--chat-color); animation: pulse 1.5s infinite; }
        .highlight-price { color: var(--chat-color); font-size: 1.4em; }
        .highlight-button { background-color: var(--chat-color); box-shadow: 0 4px 10px rgba(255, 102, 0, 0.4); }
        .highlight-button:hover { background-color: #e65c00; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- WALLET SECTION STYLES (ĐÃ CHỈNH SỬA) --- */
        .wallet-summary { 
            text-align: center; 
            /* Nền Gradient Tối - Xịn hơn */
            background: linear-gradient(145deg, var(--wallet-dark-bg), #333); 
            color: white; 
            border: 2px solid var(--wallet-glow);
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5), 0 0 10px rgba(0, 198, 255, 0.4);
            position: relative;
            overflow: hidden;
        }
        .wallet-summary h4 {
            color: var(--wallet-glow);
            margin: 0 0 15px 0;
            font-size: 1.1em;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .balance-display { 
            font-size: 2.5em; /* Kích thước vừa phải */
            color: white; 
            margin: 0; 
            font-weight: 900; 
            position: relative;
            display: inline-block;
            /* Tạo không gian cho hiệu ứng ánh sáng */
            overflow: hidden; 
            line-height: 1.2;
            
            /* Text gradient & shadow cơ bản */
            background: linear-gradient(90deg, #fff, var(--highlight-yellow), #fff);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .balance-display strong {
            position: relative;
        }
        
        /* Hiệu ứng ánh sáng Shimmer */
        .balance-display strong::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: skewX(-20deg);
            animation: shimmer 5s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 150%; }
        }

        /* Input Nạp tiền */
        .top-up-section input { 
            width: 100%; 
            padding: 12px 15px;
            margin-bottom: 15px; 
            border: 2px solid #ccc; 
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 1.1em;
            font-weight: bold;
            text-align: left; /* Hiển thị số tiền từ trái */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .top-up-section input:focus {
             border-color: var(--chat-color);
             box-shadow: 0 0 8px rgba(255, 102, 0, 0.5);
             outline: none;
        }
        .top-up-section input::placeholder {
            color: #aaa;
            font-weight: normal;
            font-style: italic;
        }
        .top-up-section label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            color: var(--text-color);
        }
        
        .btn-top-up { 
            background-color: var(--chat-color); /* Màu cam nổi bật */
            color: white; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            width: 100%; 
            transition: background-color 0.2s; 
            font-size: 1.1em;
            box-shadow: 0 4px 10px rgba(255, 102, 0, 0.4);
        }
        .btn-top-up:hover { background-color: #e65c00; }
        .top-up-note { font-size: 0.85em; color: #888; margin-top: 15px; text-align: center; }
        
        .history-tabs { display: flex; margin-bottom: 15px; border-bottom: 2px solid var(--primary-bg-color); }
        .tab-button { flex-grow: 1; padding: 12px 0; margin: 0 5px; background: none; border: none; cursor: pointer; font-weight: bold; color: #888; border-bottom: 3px solid transparent; transition: color 0.2s, border-bottom-color 0.2s; }
        .tab-button.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
        
        /* --- HISTORY TABLE STYLES --- */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            text-align: left;
            margin-top: 10px;
        }
        .history-table th {
            background-color: var(--active-bg-color);
            color: var(--mmo-bg-dark);
            padding: 10px;
            font-weight: bold;
            border-bottom: 2px solid #ccc;
        }
        .history-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        .history-table tr:hover {
            background-color: #f9f9f9;
        }
        .history-table .transaction-type {
            font-weight: bold;
        }
        .history-table .amount-plus {
            color: var(--success-color);
            font-weight: bold;
        }
        .history-table .amount-minus {
            color: var(--chat-color); /* Màu cam cho thanh toán */
            font-weight: bold;
        }
        .history-table .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .history-table .status-complete {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--success-color);
        }
        .history-table .status-delivered {
            background-color: rgba(0, 123, 255, 0.15);
            color: var(--accent-color);
        }
        
        .history-content { 
            max-height: 400px; 
            overflow-y: auto; 
            padding: 0;
        }
        /* --- END HISTORY TABLE STYLES --- */

        /* --- TOPUP MODAL STYLES (Cập nhật - Thêm hiệu ứng) --- */
        #topup-modal .modal-content {
            background: linear-gradient(180deg, #f0f8ff, #ffffff);
            border: 3px solid var(--support-color);
            box-shadow: 0 5px 25px rgba(0, 189, 212, 0.4);
            transform: scale(0.9); /* Bắt đầu nhỏ hơn */
            transition: transform 0.4s ease-out, box-shadow 0.4s ease-out;
        }
        #topup-modal.show-modal .modal-content {
             transform: scale(1);
        }
        
        #topup-modal h3 {
            color: var(--support-color);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        #topup-modal h3 i {
            margin-right: 8px;
            animation: bounce-icon 1s infinite alternate;
        }

        @keyframes bounce-icon {
            from { transform: translateY(0); }
            to { transform: translateY(-3px); }
        }

        #topup-modal p {
            text-align: center;
            font-size: 1.1em;
        }
        #topup-amount-display {
            font-size: 1.8em !important;
            color: var(--chat-color) !important;
            display: block;
            margin: 10px 0 20px 0;
            font-weight: 900;
            text-shadow: 1px 1px 5px rgba(255, 102, 0, 0.5); /* Bóng đổ mạnh hơn */
            animation: pulse-amount 1.5s infinite alternate;
        }

        @keyframes pulse-amount {
            0% { opacity: 0.9; }
            100% { opacity: 1; transform: scale(1.01); }
        }

        /* --- COPY BUTTON STYLES (MỚI) --- */
        .copy-info-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }
        .copy-info-line:last-child {
            border-bottom: none; /* Loại bỏ đường kẻ cho dòng cuối */
        }
        .copy-info-line p {
            /* Đảm bảo nội dung chuyển khoản không bị quá dài */
            flex-grow: 1;
            word-break: break-all;
            margin-right: 10px;
            margin: 0; /* Đảm bảo không có margin thừa từ thẻ p con */
            text-align: left; /* Đảm bảo căn trái cho nội dung */
            display: flex; /* Dùng flex cho p con để căn icon */
            align-items: center;
        }
        
        /* Chỉnh lại font cho Nội dung chuyển khoản */
        .copy-info-line.note-important p strong {
             font-size: 1em; /* Giữ kích thước mặc định */
        }

        .copy-button {
            background-color: var(--support-color); /* Màu xanh ngọc */
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0; /* Ngăn nút co lại */
        }

        .copy-button:hover {
            background-color: #008c99;
            transform: scale(1.05);
        }
        .copy-button:active {
            transform: scale(0.95);
        }
        /* --- END COPY BUTTON STYLES --- */
        
        .transfer-details {
            background-color: #e6f7ff; /* Nền xanh nhạt hơn */
            border: 1px dashed var(--support-color);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: left;
        }
        .transfer-details p strong {
            color: var(--mmo-bg-dark);
            font-weight: bold;
        }
        
        .transfer-details .copy-info-line span {
            color: var(--mmo-bg-dark); /* Màu chữ cho nội dung copy */
            font-weight: bold;
            margin-left: 5px;
        }

        .note-important { 
            color: red; 
            font-weight: bold; 
            font-size: 1.1em;
            padding-top: 10px;
            margin-top: 15px;
        }
        .note-important strong {
            color: var(--chat-color) !important;
            background-color: var(--highlight-yellow); /* Dùng màu highlight */
            padding: 2px 5px;
            border-radius: 3px;
            box-shadow: 0 0 5px rgba(255, 102, 0, 0.2);
            display: inline-block;
            word-break: break-all;
            /* Hiệu ứng flash cho nội dung bắt buộc */
            animation: flash-border 2s infinite; 
        }

        @keyframes flash-border {
            0% { border: 1px solid transparent; }
            50% { border: 1px solid var(--chat-color); }
            100% { border: 1px solid transparent; }
        }
    
        #topup-modal .btn-primary { 
            background-color: var(--success-color); /* Đổi nút chính thành màu Success */
            color: white; 
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
        }
        #topup-modal .btn-primary:hover {
            background-color: #218838;
        }

        /* Modal Chi tiết Server */
        #server-detail-modal .modal-content {
            background-color: #f7f7f7;
            border: 2px solid var(--accent-color);
            padding: 30px;
        }

        #server-detail-modal h3 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--support-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .server-info-detail p {
            font-size: 1em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dotted #ccc;
            padding-bottom: 5px;
        }

        .server-info-detail strong {
            color: var(--mmo-bg-dark);
            font-weight: bold;
        }

        .server-info-detail .status-good {
            color: var(--success-color);
            font-weight: 900;
        }


        /* [GIỮ NGUYÊN CÁC CSS CÒN LẠI] */
        .item-name { flex-grow: 1; padding-right: 15px; }
        .transfer-details p { margin: 5px 0; font-size: 0.9em; }
        .note-important { color: red; font-weight: bold; }
        .btn-cancel { background: none; color: #888; border: none; padding: 10px; margin-top: 10px; width: 100%; cursor: pointer; }

        /* --- TỐI ƯU PROFILE PAGE (CÁ NHÂN) --- */
        .profile-page {
            /* Loại bỏ padding mặc định nếu cần (hoặc giữ nguyên) */
            padding-top: 20px;
            padding-bottom: 20px;
        }
        
        /* Tối ưu Card Thông tin Tài khoản */
        .account-info-card {
            background: linear-gradient(145deg, var(--accent-color), #0056b3); /* Gradient xanh dương */
            color: white;
            border: none;
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4);
            transition: transform 0.3s ease-out;
        }
        .account-info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 123, 255, 0.6);
        }

        .account-info-card .card-header {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.5);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .account-info-card .card-header i {
            color: var(--highlight-yellow); /* Icon màu vàng kim */
        }
        .account-info-card .card-header h4 {
            color: white;
            font-size: 1.2em;
        }

        .account-info-card p { 
            margin: 10px 0; 
            font-size: 1.05em;
            display: flex; /* Dùng flex để căn chỉnh */
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dotted rgba(255, 255, 255, 0.2);
        }

        .account-info-card p strong {
            color: var(--highlight-yellow);
            font-weight: 900;
            font-size: 1.1em;
        }

        .logout-button {
            background-color: var(--chat-color) !important; 
            border: 2px solid white;
            margin-top: 15px !important;
            transition: background-color 0.2s, transform 0.2s;
        }
        .logout-button:hover {
            background-color: #e65c00 !important;
            transform: scale(1.02);
        }

        /* --- KHO ĐỒ (INVENTORY) --- */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* 2 cột trên desktop, 1 cột trên mobile */
            gap: 20px;
            margin-top: 20px;
        }

        .inventory-item-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--active-bg-color);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .inventory-item-card:hover {
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.2);
            border-color: var(--chat-color);
        }

        .item-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-bg-color);
        }
        .item-header i {
            font-size: 1.8em;
            color: var(--chat-color); /* Màu cam cho icon chính */
            margin-right: 10px;
        }
        .item-header h5 {
            margin: 0;
            font-size: 1.1em;
            color: var(--mmo-bg-dark);
        }

        .item-details p {
            margin: 8px 0;
            font-size: 0.95em;
            display: flex;
            justify-content: space-between;
        }
        .item-details p strong {
            color: var(--accent-color);
        }

        .item-status {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--success-color);
            color: white;
            padding: 5px 15px;
            border-radius: 0 10px 0 10px;
            font-weight: bold;
            font-size: 0.8em;
            transform: rotate(3deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .item-status.expired {
            background-color: red;
        }

        .item-actions {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .btn-item-action {
            background-color: var(--support-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s;
            flex-grow: 1;
        }
        .btn-item-action:hover {
            background-color: #008c99;
        }
        .btn-item-action.red {
            background-color: var(--chat-color);
        }
        .btn-item-action.red:hover {
            background-color: #e65c00;
        }

        @media (max-width: 600px) {
            .profile-page .card {
                 max-width: 100%;
                 margin: 0 0 20px 0;
            }
        }
        /* --- END PROFILE PAGE STYLES --- */


        .profile-page label { display: block; font-weight: bold; margin-top: 10px; margin-bottom: 5px; font-size: 0.9em; }
        .profile-page input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .account-info-card p { margin: 8px 0; font-size: 1em; }
        .registration-card { border: 1px solid var(--accent-color); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        .btn-secondary { background-color: var(--active-bg-color); color: var(--text-color); padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; transition: background-color 0.2s; }
        .btn-secondary:hover { background-color: #ccc; }
        
        .registration-step {
            display: none;
        }
        
        .auth-switch-prompt {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
            padding: 5px 0;
        }
        .auth-switch-prompt a {
            color: var(--accent-color); 
            font-weight: bold;
            text-decoration: none;
        }
        .auth-switch-prompt a:hover {
            text-decoration: underline;
        }


        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%; 
            max-width: 400px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        #modal-details { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .quantity-control { display: flex; align-items: center; justify-content: center; margin: 15px 0; }
        .quantity-control label { font-weight: bold; margin-right: 15px; }
        .quantity-control input { width: 50px; padding: 8px 5px; border: 1px solid #ccc; text-align: center; font-size: 1em; -moz-appearance: textfield; }
        .quantity-control input::-webkit-outer-spin-button,
        .quantity-control input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .qty-button { background-color: var(--primary-bg-color); border: 1px solid #ccc; padding: 8px 12px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: background-color 0.15s; }
        .qty-button:hover { background-color: #ddd; }
        .qty-minus { border-radius: 5px 0 0 5px; margin-right: -1px; }
        .qty-plus { border-radius: 0 5px 5px 0; margin-left: -1px; }
        .total-info { margin-top: 15px; font-size: 1.1em; padding: 10px 0; border-top: 1px solid #eee; }
        #confirm-buy-button { background-color: var(--success-color); color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1.1em; margin-top: 10px; transition: background-color 0.2s; }
        #purchase-type-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            box-sizing: border-box;
        }

        .floating-buttons { 
            position: fixed; 
            left: 20px; 
            bottom: 90px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            z-index: 999; 
        }
        .floating-button { 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
            transition: transform 0.2s ease, box-shadow 0.2s ease; 
            font-size: 1.2em; 
            text-decoration: none; 
        }
        .floating-button:hover { 
            transform: scale(1.1); 
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); 
        }
        .chat-button { background-color: var(--support-color); } 
        .support-button { background-color: var(--chat-color); } 
        
        #chat-widget { 
            position: fixed; 
            bottom: 90px; 
            left: 20px; 
            width: 300px; 
            height: 400px; 
            background-color: white; 
            border: none; 
            border-radius: 12px; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25); 
            z-index: 1000; 
            display: none; 
            flex-direction: column; 
            overflow: hidden; 
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform-origin: bottom left;
        }

        #chat-widget.show-chat {
            display: flex;
            opacity: 1;
            transform: scale(1);
        }

        .chat-header { 
            background: linear-gradient(90deg, var(--support-color), #00a6b3); 
            color: white; 
            padding: 12px 15px; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-size: 1.1em;
        }
        .chat-header button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .chat-header button:hover {
            opacity: 1;
        }
        
        .chat-body { 
            flex-grow: 1; 
            padding: 15px; 
            overflow-y: auto; 
            background-color: #f7f7f7; 
            display: flex; 
            flex-direction: column; 
        }
        
        .chat-input { 
            padding: 10px; 
            border-top: 1px solid #e0e0e0; 
            display: flex; 
            align-items: center;
            background-color: #fff;
        }
        
        .chat-input input {
            flex-grow: 1;
            padding: 8px 15px;
            border: 1px solid #ccc;
            border-radius: 20px;
            margin-right: 10px;
            font-size: 0.95em;
            transition: border-color 0.2s;
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--support-color);
            box-shadow: 0 0 5px rgba(0, 189, 212, 0.3);
        }
        
        .chat-input button {
            background-color: var(--support-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            font-size: 1.1em;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .chat-input button:hover {
            background-color: #008c99;
            transform: scale(1.05);
        }

        .message { 
            margin-bottom: 12px; 
            padding: 10px 15px; 
            border-radius: 18px; 
            max-width: 85%; 
            word-wrap: break-word; 
            font-size: 0.9em; 
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .message.bot { 
            background-color: #e6f7ff; 
            align-self: flex-start; 
            margin-right: auto; 
            border-bottom-left-radius: 4px; 
            color: var(--text-color);
        }
        
        .message.user { 
            background-color: var(--accent-color); 
            color: white; 
            align-self: flex-end; 
            margin-left: auto; 
            border-bottom-right-radius: 4px; 
        }
        
        .message.bot strong {
            color: var(--support-color);
        }
        
        .bot-icon {
            font-size: 1.2em;
            margin-right: 5px;
        }
        
        .chat-header i {
            margin-right: 5px;
        }
    </style>
</head>
<body>

    <header class="top-bar">
        <div class="website-name-container">
            <i class="fa-solid fa-globe-asia globe-icon"></i> 
            <div class="website-name">MMO</div>
        </div>

        <div class="user-info">
            <div class="server-status" onclick="showServerDetailModal()">
                <span class="flag">
</span>
                Server: 🌐VN-n10
                <span class="status-dot active"></span>
            </div>
            
            <div class="balance" onclick="showSection('wallet', document.querySelector('.navbar-item:nth-child(3) a'))">
                <i class="fa-solid fa-money-check-dollar"></i>
                Số dư: 
                <strong id="user-balance">0 VNĐ</strong>
            </div>
        </div>
    </header>
    
    <div class="floating-notification-wrapper">
        <div id="promo-notification" class="floating-notification" onclick="showSection('shop', document.querySelector('.navbar-item:nth-child(2) a'))">
            <i class="fa-solid fa-bell notification-icon"></i>
            <span class="notification-text">
                Sốc! Tài khoản **TikTok Lite** đang giảm **30%**!
            </span>
             <span class="notification-action">MUA NGAY <i class="fa-solid fa-arrow-right"></i></span>
        </div>
    </div>
    <div class="sales-ticker-wrapper" style="--ticker-speed: 120s;">
        <div id="sales-ticker-content" class="sales-ticker-content">
            </div>
    </div>
    <div class="content">
        <div id="menu-section" class="section menu-homepage">
            <h1 id="content-title" style="display: none;">Nội dung của Menu</h1>
            <p id="content-text" style="display: none;">Chọn một mục từ thanh menu dưới hoặc dùng Chat Bot để được hỗ trợ.</p>
            
            <div class="card event-banner animated">
                <h3>🎉Sự kiện Đang Diễn Ra🎁 Khuyến mãi Nạp tiền Hàng tuần!</h3>
                <p>Tặng thêm 10% giá trị nạp vào lần đầu tiên và nạp vào từ 6h-19h.Nạp Số tiền lớn x200% lần đầu</p>
                <button class="btn-primary" onclick="showSection('wallet', document.querySelector('.navbar-item:nth-child(3) a'))" id="menu-topup-btn" disabled>Đăng ký để nạp</button>
            </div>

            <div class="grid-container">
                
                <div class="main-column">
                    
                    <div class="card product-highlight">
                        <div class="card-header">
                            <i class="fa-solid fa-fire"></i>
                            <h4>Sản phẩm Hot Nhất</h4>
                        </div>
                        <ul id="hot-products-list">
                            <li>•Tài khoản TikTok Lite: <span class="price-tag">70.000 VNĐ</span> (Số Lượng <span id="hot-stock-tiktok-lite">99+</span>)</li>
                            <li>•Tài khoản Gogo Lite: <span class="price-tag">120.000 VNĐ</span> (Số Lượng <span id="hot-stock-gogo-lite">850</span>)</li>
                            <li>•Tiktok Beta: <span class="price-tag">1.500.000 VNĐ</span> (Số Lượng <span id="hot-stock-tiktok-beta">50</span>)</li>
                        </ul>
                        <a href="#" onclick="showSection('shop', document.querySelector('.navbar-item:nth-child(2) a'))" class="btn-link">Xem tất cả tại Shop <i class="fa-solid fa-arrow-right"></i></a>
                    </div>

                    <div class="card account-summary">
                        <div class="card-header">
                            <i class="fa-solid fa-user-circle"></i>
                            <h4>Thông tin Tài khoản</h4>
                        </div>
                        <div class="summary-details">
                            <p>Chào mừng <strong id="welcome-username">Khách</strong></p>
                            <p>Số dư Ví: <strong class="balance-amount" id="menu-balance-amount">Chưa liên kết</strong></p>
                            <p>Đã mua: <strong id="total-purchases">0</strong> sản phẩm</p>
                        </div>
                        <a href="#" onclick="showSection('wallet', document.querySelector('.navbar-item:nth-child(3) a'))" class="btn-link">Nạp tiền & Xem lịch sử <i class="fa-solid fa-arrow-right"></i></a>
                    </div>

                </div>

                <div class="sidebar-column">
                    
                    <div class="card instruction-card">
                        <div class="card-header">
                            <i class="fa-solid fa-money-bill-transfer"></i>
                            <h4>Lưu ý Nạp tiền</h4>
                        </div>
                        <ol>
                            <li>Chọn phương thức:Thanh toán qua tài khoản của sàn web</li>
                            
<li>Nội dung chuyển khoản: Ghi rõ chuyển khoản mà web cho sẵn yêu cầu là phải chính xác tuyệt đối  (VD: ID1234)</li>
                            <li>Thời gian xử lý: Tự động trong 1-3 phút. Nếu quá 15 phút, liên hệ Hỗ trợ , liên hệ qua đội ngũ hỗ trợ trực tiếp ỏ góc bên trái.</li>
                        </ol>
                    </div>

                    <div class="card instruction-card">
                        <div class="card-header">
                            <i class="fa-solid fa-circle-exclamation"></i>
                            <h4>Lưu ý Quan trọng</h4>
                        </div>
                        <ul>
                            <li>Kiểm tra ngay:Sau khi mua, vui lòng kiểm tra tài khoản trong 1 giờ , Tài khoản sau khi mua sẽ nằm ỏ kho đồ vào đấy sẽ xem được thông tin chi tiết của tài khoản bạn đã mua .</li>
                            <li>Bảo mật:Không cung cấp mật khẩu cho bất kỳ ai.Nếu có bên thứ ba đăng nhập vào tài khoản của bạn thì sẽ không được baoe hành và hoàn tiền</li>
                            
<li>Hỗ trợ:Mọi vấn đề kỹ thuật liên hệ qua Telegram ở góc trái.</li>
                        </ul>
                    </div>

                </div>
            </div>
            
            <div class="card detail-section" style="margin-top: 20px;">
                <div class="card-header" style="border-bottom: 2px solid var(--accent-color);">
                    <i class="fa-solid fa-list-check" style="color: var(--chat-color);"></i>
                    <h4>Chi Tiết Sản Phẩm & Chính Sách</h4>
                </div>
                
                <div class="product-detail-item">
                    <h5><i class="fa-brands fa-tiktok"></i> Tài khoản TikTok Lite/Gogo Lite</h5>
                    <p style="font-size: 0.9em; margin-top: 5px;">
                        Công dụng:tik tok lite là sàn liên kết với tik tok kiếm tiền từ việc điểm danh và xem video hàng ngày , mỗi ngày kiếm được 25k/ngày từ điểm danh . GoGo lite là sàn xịn hơn và nhiều nhiệm vụ hơn , bạn có thể điểm danh và nhập code , chơi game và làm nghiệm vụ ngày kiếm được 30-55k/ngày.
                    </p>
                    <p style="font-size: 0.9em;">
                        Gói đăng ký & Hạn sử dụng:
                        <ul>
                            <li>Gói 30/60/90 Ngày:Là gói thuê bao, giá rẻ nhất, phù hợp cho chiến dịch ngắn hạn. Tự động gia hạn nếu có nhu cầu.</li>
                            <li>Gói Vĩnh viễn (Có BH):Mua đứt tài khoản, bảo hành đổi mới 1 lần nếu bị khóa do lỗi hệ thống trong 30 ngày đầu.</li>
                        </ul>
                    </p>
                    <p style="font-size: 0.9em; font-weight: bold; color: var(--success-color);">
                        Tình trạng hoạt động:Hoạt động ổn định tại Server VN-A. Được bảo trợ bởi hệ thống phân phối M-Farm Solutions.
                    </p>
                </div>
                
                <div class="product-detail-item" style="border-top: 1px dashed #eee; padding-top: 15px; margin-top: 15px;">
                    <h5><i class="fa-solid fa-sack-dollar"></i> Tiktok Beta (Tài khoản Kiếm tiền US/EU)</h5>
                    <p style="font-size: 0.9em; margin-top: 5px;">
                        Công dụng:Dùng để đăng video kiếm tiền trực tiếp từ chương trình Beta Creator Fund của TikTok. Tài khoản đã đạt ngưỡng 10K Followers và đủ điều kiện vùng địa lý (US/EU).
                    </p>
                    <p style="font-size: 0.9em;">
                        Bảo hành:Bảo hành 7 ngày sau khi giao dịch, đảm bảo tài khoản sạch, không bị vi phạm chính sách hoặc bị tước quyền kiếm tiền tại thời điểm bàn giao.
                    </p>
                    <p style="font-size: 0.9em; font-weight: bold; color: var(--accent-color);">
                        Tài trợ/Đối tác:Tài khoản được cung cấp thông qua đối tác MCN quốc tế GlobalReach Media. Cần sử dụng VPN/Proxy sạch (có thể mua tại Shop) để duy trì hoạt động.
                    </p>
                </div>

                <div class="product-detail-item" style="border-top: 1px dashed #eee; padding-top: 15px; margin-top: 15px;">
                    <h5><i class="fa-solid fa-shield-halved"></i> Dịch vụ VPN/Proxy Chất lượng</h5>
                    <p style="font-size: 0.9em; margin-top: 5px;">
                        Công dụng:Thay đổi địa chỉ IP, bảo mật kết nối. Bắt buộc khi làm MMO quốc tế để tránh bị chặn, bị gắn cờ spam hoặc bị giới hạn thu nhập vùng.
                    </p>
                    <p style="font-size: 0.9em;">
                        Cách sử dụng:Cung cấp thông tin đăng nhập sau khi thanh toán. Chỉ định rõ quốc gia (US, EU, UK, JP) khi mua.
                    </p>
                    <p style="font-size: 0.9em; font-weight: bold; color: var(--support-color);">
                        Thời gian:Đều là gói thuê bao 30 Ngày. Cung cấp IP cá nhân (Private), không chia sẻ, đảm bảo tốc độ và độ trễ thấp.
                    </p>
                </div>
            </div>
            
            <div class="card detail-section" style="margin-top: 20px;">
                <div class="card-header" style="border-bottom: 2px solid var(--support-color);">
                    <i class="fa-solid fa-address-book" style="color: var(--support-color);"></i>
                    <h4>Liên Hệ & Thông Tin Chung</h4>
                </div>
                
                <div class="grid-container" style="display: flex; gap: 20px;">
                    
                    <div class="main-column" style="flex: 1;">
                        <div class="product-detail-item">
                            <h5><i class="fa-solid fa-phone-volume"></i> Liên Hệ </h5>
                            <p style="font-size: 0.9em; margin-top: 5px; font-weight: bold; color: red;">
                                <i class="fa-solid fa-triangle-exclamation"></i> Liên hệ NGAY khi gặp sự cố!
                            </p>
                            <ul class="contact-list" style="list-style: none; padding-left: 0;">
                                <li>
                                    <i class="fa-solid fa-headset" style="color: var(--support-color);"></i>
                                    Chat với Hỗ trợ viên: <a href="https://t.me/nhatpham27" target="_blank" class="btn-link" style="display: inline; margin: 0;">Telegram</a>
                                </ li>
                                <li>
                                    <i class="fa-brands fa-facebook" style="color: #1877f2;"></i> 
                                    Facebook: MMO Nick
                                
</li>
                                <li>
                                    <i class="fa-solid fa-envelope" style="color: var(--chat-color);"></i> 
                                    Gmail : support.TKMMO@gmail.com
                              
</li>
                                <li>
                                    <i class="fa-solid fa-clock" style="color: #6c757d;"></i> 
                                    Thời gian hỗ trợ: 
08:00 - 00:00 (T2 - CN)
                                
</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="sidebar-column" style="flex: 1;">
                         <div class="product-detail-item">
                            <h5><i class="fa-solid fa-circle-info"></i> Thông Tin Về Web </h5>
                            <p style="font-size: 0.9em; margin-top: 5px;">
                                <i class="fa-solid fa-check-circle" style="color: var(--success-color);"></i> Ứng dụng trao đổi mua bán tài khoản UY TÍN.
                            </p>
                            <p style="font-size: 0.9em;">
                                <i class="fa-solid fa-people-group" style="color: var(--accent-color);"></i> Cộng đồng kiếm tiền online lớn mạnh.
                            </p>
                            <p style="font-size: 0.9em; font-weight: bold; color: var(--chat-color);">
                                <i class="fa-solid fa-bolt"></i> Thanh toán tự động, xử lý giao dịch ngay lập tức.
                            </p>
                        </div>
                    </div>

                </div>
            </div>
            
            <div class="card detail-section" style="margin-top: 20px;">
                <div class="card-header" style="border-bottom: 2px solid var(--success-color);">
                    <i class="fa-solid fa-star-half-stroke" style="color: var(--success-color);"></i>
                    <h4>Đánh Giá Khách Hàng & Gửi Review</h4>
                </div>
                
                <div class="reviews-list">
                    
                    <div class="review-item" style="border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px;">
                        <div class="review-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong style="color: var(--accent-color);">Tài khoản: Ahh763</strong>
                            <span class="rating" style="color: gold;"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i> (5.0)</span>
                        </div>
                        <p style="font-size: 0.9em; margin: 0; color: var(--text-color);">"Đã mua TikTok Beta ở đây, giao dịch nhanh chóng và tài khoản sạch, bắt đầu kiếm tiền ngay sau 24h. Hỗ trợ Telegram rất nhiệt tình!"</p>
                        <span style="font-size: 0.75em; color: #888;">- 12 lượt thích</span>
                    </div>

                    <div class="review-item" style="border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 15px;">
                        <div class="review-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong style="color: var(--accent-color);">Tài khoản: Vina77</strong>
                            <span class="rating" style="color: gold;"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i> (4.8)</span>
                        </div>
                        <p style="font-size: 0.9em; margin: 0; color: var(--text-color);">"Hệ thống nạp tiền tự động quá tiện, mua 5 acc Gogo Lite một lúc cũng xong ngay. Chăm sóc khách hàng hơi chậm một chút vào buổi tối, nhưng vẫn đáng 5 sao."</p>
                        <span style="font-size: 0.75em; color: #888;">- 5 lượt thích</span>
                    </div>

                    <div class="review-item">
                        <div class="review-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong style="color: var(--accent-color);">Tài khoản: Bin9</strong>
                            <span class="rating" style="color: gold;"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i> (5.0)</span>
                        </div>
                        <p style="font-size: 0.9em; margin: 0; color: var(--text-color);">"Proxy mua dùng cực ổn định, IP sạch. Từ lúc dùng dịch vụ bên đây mình không còn lo bị ban IP nữa. Rất uy tín!"</p>
                        <span style="font-size: 0.75em; color: #888;">- 21 lượt thích</span>
                    </div>
                </div>

                <div class="card" style="margin-top: 25px; background-color: var(--active-bg-color); padding: 15px;">
                    <h5 style="margin-top: 0; color: var(--chat-color);"><i class="fa-solid fa-pen-to-square"></i> Gửi Đánh Giá Của Bạn</h5>
                    <form id="review-form" onsubmit="handleReviewSubmit(event)">
                        
                        <label for="review-stars" style="font-weight: bold; margin-bottom: 5px; display: block;">Chọn Số Sao (5 Sao là Tốt Nhất):</label>
                        <div id="star-rating" style="font-size: 1.5em; color: lightgray; cursor: pointer;">
                            <i class="fa-regular fa-star" data-rating="1" onclick="setRating(1)"></i>
                            <i class="fa-regular fa-star" data-rating="2" onclick="setRating(2)"></i>
                            <i class="fa-regular fa-star" data-rating="3" onclick="setRating(3)"></i>
                            <i class="fa-regular fa-star" data-rating="4" onclick="setRating(4)"></i>
                            <i class="fa-regular fa-star" data-rating="5" onclick="setRating(5)"></i>
                        </div>
                        <input type="hidden" id="selected-rating" value="5" required>
                        
                        <label for="review-comment" style="font-weight: bold; margin-top: 15px; margin-bottom: 5px; display: block;">Bình luận của bạn:</label>
                        <textarea id="review-comment" rows="3" placeholder="Chia sẻ kinh nghiệm của bạn về dịch vụ/sản phẩm..." style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;" required></textarea>

                        <button type="submit" class="btn-primary" style="background-color: var(--success-color); color: white; margin-top: 10px; width: 100%;" disabled>Đăng ký để gửi đánh giá</button>
                    </form>
                    <p id="review-message" style="margin-top: 10px; font-size: 0.9em; color: var(--text-color);">💬Đánh giá của bạn sẽ khiến chúng tôi phát triển và cải thiện tốt hơn .</p>
                </div>
            </div>
        </div>
        
        <div id="shop-section" class="section shop-page" style="display: none;">
            
            <div class="shop-header">
                <h1>
                    <span>D</span><span>a</span><span>n</span><span>h</span> 
                    <span>M</span><span>ụ</span><span>c</span> 
                    <span>S</span><span>ả</span><span>n</span> 
                    <span>P</span><span>h</span><span>ẩ</span><span>m</span>
                </h1>
                <p>Khám phá các loại tài khoản và dịch vụ chất lượng cao, tối ưu cho nhu cầu kiếm tiền online (MMO).</p>
            </div>

            <div class="product-grid">
                
                <div class="product-card tik-tok-lite">
                    <div class="card-icon">
                        <i class="fa-brands fa-tiktok"></i>
                    </div>
                    <h3 class="product-title">Tài khoản TikTok Lite</h3>
                    <p class="product-description">Tài khoản sạch, sẵn sàng nhận nhiệm vụ,chỉ cần liên kết là sử dụng .</p>
                    <div class="product-info">
                        <span class="stock" id="stock-tiktok-lite">Còn hàng: Không giới hạn</span>
                        <span class="price">70.000 VNĐ</span> 
                    </div>
                    <button class="buy-button" onclick="openModal('tiktok-lite', 'Tài khoản TikTok Lite', 70000, 9999, true)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card gogo-lite">
                    <div class="card-icon">
                        <i class="fa-solid fa-user-check"></i>
                    </div>
                    <h3 class="product-title">Tài khoản Gogo Lite</h3>
                    <p class="product-description">Tài khoản đã liên kết sàn chỉ cần đăng nhập để làm nghiệm vụ.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-gogo-lite">Còn hàng: Không giới hạn</span>
                        <span class="price">120.000 VNĐ</span> 
                    </div>
                    <button class="buy-button" onclick="openModal('gogo-lite', 'Tài khoản Gogo Lite', 120000, 9999, true)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card tik-tok-beta highlight-card">
                    <div class="card-icon">
                        <i class="fa-solid fa-sack-dollar"></i>
                    </div>
                    <h3 class="product-title">Tiktok Beta (Đã bật Kiếm tiền)</h3>
                    <p class="product-description">Tài khoản US/EU, đủ điều kiện, sẵn sàng nhận doanh thu.</p>
                    <div class="product-info">
                        <span class="stock highlight-stock" id="stock-tiktok-beta">SỐ LƯỢNG CÓ HẠN: 50</span>
                        <span class="price highlight-price">1.500.000 VNĐ</span>
                    </div>
                    <button class="buy-button highlight-button" onclick="openModal('tiktok-beta', 'Tiktok Beta (Kiếm tiền)', 1500000, 50, false)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card vpn-quality">
                    <div class="card-icon">
                        <i class="fa-solid fa-shield-halved"></i>
                    </div>
                    <h3 class="product-title">Mua VPN Chất lượng</h3>
                    <p class="product-description">IP sạch, tốc độ cao, bảo mật tuyệt đối cho mọi tác vụ.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-vpn">Duy trì: 1 Tháng</span>
                        <span class="price">150.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('vpn-quality', 'Mua VPN Chất lượng', 150000, 9999, false)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card proxy-quality">
                    <div class="card-icon">
                        <i class="fa-solid fa-server"></i>
                    </div>
                    <h3 class="product-title">Mua Proxy Chất lượng</h3>
                    <p class="product-description">Private Proxy, nhiều vị trí địa lý, độ trễ thấp.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-proxy">Duy trì: 1 Tháng</span>
                        <span class="price">120.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('proxy-quality', 'Mua Proxy Chất lượng', 120000, 9999, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card gmail-old">
                    <div class="card-icon" style="color: #ea4335; background-color: #fce8e6;">
                        <i class="fa-brands fa-google"></i>
                    </div>
                    <h3 class="product-title">Tài khoản Gmail Cổ (1-3 Năm)</h3>
                    <p class="product-description">Gmail đã tạo lâu, độ tin cậy cao, dùng cho các nền tảng chống spam.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-gmail-old">Còn hàng: 500+</span>
                        <span class="price">25.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('gmail-old', 'Tài khoản Gmail Cổ', 25000, 500, false)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card fb-old highlight-card" style="border-color: #1877f2;">
                    <div class="card-icon" style="color: #1877f2; background-color: #e6f2ff;">
                        <i class="fa-brands fa-facebook"></i>
                    </div>
                    <h3 class="product-title">Tài khoản FB Cổ (5-10 Năm)</h3>
                    <p class="product-description">Tài khoản Trust Score cực cao, sẵn sàng chạy Quảng cáo và chống bị khóa.</p>
                    <div class="product-info">
                        <span class="stock highlight-stock" id="stock-fb-old" style="color: #1877f2;">SỐ LƯỢNG CÓ HẠN: 20</span>
                        <span class="price highlight-price" style="color: #1877f2;">1.800.000 VNĐ</span>
                    </div>
                    <button class="buy-button" style="background-color: #1877f2;" onclick="openModal('fb-old', 'Tài khoản FB Cổ', 1800000, 20, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card tiktok-new">
                    <div class="card-icon" style="color: #000; background-color: #eee;">
                        <i class="fa-brands fa-tiktok"></i>
                    </div>
                    <h3 class="product-title">TikTok New Reg (Lượng lớn)</h3>
                    <p class="product-description">Tài khoản mới đăng ký, dùng cho các chiến dịch spam/cày view quy mô lớn.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-tiktok-new">Tồn kho: 20.000+</span>
                        <span class="price">5.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('tiktok-new', 'TikTok New Reg', 5000, 20000, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card tut-dam">
                    <div class="card-icon" style="color: #8b00ff; background-color: #f3e6ff;">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <h3 class="product-title">Ebook/Tut Đào tạo MMO (Đa nền tảng)</h3>
                    <p class="product-description">Tài liệu hướng dẫn chi tiết cách tự Reg Acc, cày View, Anti-Ban mới nhất.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-tut">Bản quyền: Trọn đời</span>
                        <span class="price">2.500.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('tut-dam', 'Ebook/Tut Đào tạo MMO', 2500000, 9999, false)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card telegram-trust">
                    <div class="card-icon" style="color: #0088cc; background-color: #e0f2ff;">
                        <i class="fa-brands fa-telegram"></i>
                    </div>
                    <h3 class="product-title">Tài khoản Telegram Trust</h3>
                    <p class="product-description">Tài khoản đã có Trust Score, dùng để tạo group, gửi tin nhắn số lượng lớn.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-tele-trust">Còn hàng: 150</span>
                        <span class="price">55.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('tele-trust', 'Tài khoản Telegram Trust', 55000, 150, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card bot-server">
                    <div class="card-icon" style="color: #6a0dad; background-color: #f0e6ff;">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <h3 class="product-title">Bot Tương tác Đa nền tảng (Server License)</h3>
                    <p class="product-description">License bot chạy trên server riêng, tự động tương tác/nuôi acc 24/7.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-bot-server">Duy trì: 1 Tháng</span>
                        <span class="price">3.500.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('bot-server', 'Bot Tương tác Server', 3500000, 9999, true)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card buff-service">
                    <div class="card-icon" style="color: #28a745; background-color: #e9f7eb;">
                        <i class="fa-solid fa-ranking-star"></i>
                    </div>
                    <h3 class="product-title">Dịch vụ Buff Tương tác (FB, TikTok, X)</h3>
                    <p class="product-description">Tăng Likes, Views, Follows cho mọi nền tảng Social Media.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-buff-service">Giá: Tùy gói</span>
                        <span class="price">50.000 VNĐ (từ)</span>
                    </div>
                    <button class="buy-button" onclick="openModal('buff-service', 'Dịch vụ Buff Tương tác', 50000, 9999, false)" disabled>Đăng ký để mua</button>
                </div>

                <div class="product-card unlock-service">
                    <div class="card-icon" style="color: var(--chat-color); background-color: #ffe0b2;">
                        <i class="fa-solid fa-lock-open"></i>
                    </div>
                    <h3 class="product-title">Dịch vụ Unlock Tài khoản Vĩnh viễn</h3>
                    <p class="product-description">Mở khóa các tài khoản mạng xã hội bị khóa vĩnh viễn (FB/TikTok/Google).</p>
                    <div class="product-info">
                        <span class="stock" id="stock-unlock">Cam kết: Hoàn tiền 100%</span>
                        <span class="price">1.200.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('unlock-service', 'Dịch vụ Unlock Acc', 1200000, 9999, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card twitter-verified">
                    <div class="card-icon" style="color: #000; background-color: #eee;">
                        <i class="fa-brands fa-square-x-twitter"></i>
                    </div>
                    <h3 class="product-title">Tài khoản X (Twitter) Verified</h3>
                    <p class="product-description">Tài khoản có dấu tích xanh (Xác minh), sẵn sàng cày Views/Ad Revenue.</p>
                    <div class="product-info">
                        <span class="stock" id="stock-twitter-verified">SỐ LƯỢNG CÓ HẠN: 15</span>
                        <span class="price">850.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('twitter-verified', 'Tài khoản X Verified', 850000, 15, false)" disabled>Đăng ký để mua</button>
                </div>
                
                <div class="product-card auto-tool">
                    <div class="card-icon" style="color: #ff00cc; background-color: #f0e6f2;">
                        <i class="fa-solid fa-wrench"></i>
                    </div>
                    <h3 class="product-title">Tool Auto Reg (Tự động đăng ký)</h3>
                    <p class="product-description">Phần mềm tạo hàng loạt tài khoản theo kịch bản (Yêu cầu VPS).</p>
                    <div class="product-info">
                        <span class="stock" id="stock-tool-reg">License: 1 Tháng</span>
                        <span class="price">499.000 VNĐ</span>
                    </div>
                    <button class="buy-button" onclick="openModal('tool-reg', 'Tool Auto Reg', 499000, 9999, true)" disabled>Đăng ký để mua</button>
                </div>

            </div>
        </div>
        
        <div id="wallet-section" class="section wallet-page" style="display: none;">
            
            <div class="wallet-summary card">
                <h4><i class="fa-solid fa-wallet"></i> SỐ DƯ HIỆN TẠI</h4>
                <p class="balance-display">
                    <strong id="current-wallet-balance">0 VNĐ</strong>
                </p>
            </div>

            <div class="card top-up-section">
                <div class="card-header">
                    <i class="fa-solid fa-money-bill-transfer"></i>
                    <h4>Nạp Tiền Vào Ví</h4>
                </div>
                
                <div class="top-up-form">
                    <label for="topup-amount">Nhập số tiền cần nạp (VNĐ):</label>
                    <input type="number" id="topup-amount" value="0" min="10000" placeholder="Nạp tối thiểu 10,000 VNĐ" onfocus="if(this.value=='0') this.value=''">
                    <button class="btn-top-up" onclick="showTopUpModal()" disabled>ĐĂNG KÝ</button>
                </div>
                <p class="top-up-note">Sử Lí giao dịch trong vài phút. Vui lòng làm theo hướng dẫn sau khi nhấn Nạp Tiền.</p>
            </div>

            <div class="card history-section">
                <div class="history-tabs">
                    <button class="tab-button active" onclick="showHistoryTab('transactions', this)">Lịch sử Giao dịch</button>
                    <button class="tab-button" onclick="showHistoryTab('purchases', this)">Lịch sử Mua hàng</button>
                </div>
                
                <div id="transactions-history" class="history-content">
                    <p id="no-transaction-data">Vui lòng đăng ký để xem lịch sử.</p>
                </div>

                <div id="purchases-history" class="history-content" style="display: none;">
                    <p id="no-purchase-data">Vui lòng đăng ký để xem lịch sử.</p>
                </div>
            </div>
        </div>
        
        <div id="profile-section" class="section profile-page" style="display: none;">
            
            <div id="profile-view" style="display: none;">
                
                <div class="card account-info-card">
                    <div class="card-header">
                        <i class="fa-solid fa-gem"></i>
                        <h4>Thông tin Tài khoản Của bạn</h4>
                    </div>
                    <p>
                        <span><i class="fa-solid fa-user-tag"></i> Tên Tài khoản:</span>
                        <strong id="display-username"></strong>
                    </p>
                    <p>
                        <span><i class="fa-solid fa-envelope"></i> Liên kết bằng:</span>
                        <span id="display-email-phone"></span>
                    </p>
                    <p>
                        <span><i class="fa-solid fa-calendar-alt"></i> Ngày tham gia:</span>
                        <span id="display-join-date"></span>
                    </p>
                    <p style="border-bottom: none;">
                        <span><i class="fa-solid fa-wallet"></i> Số dư Ví:</span>
                        <strong id="display-balance" class="balance-amount"></strong>
                    </p>
                    
                    <button class="btn-top-up logout-button" onclick="logoutUser()">
                        <i class="fa-solid fa-sign-out-alt"></i> Đăng Xuất
                    </button>
                </div>
                
                <div class="card" style="margin-top: 25px;">
                    <div class="card-header">
                        <i class="fa-solid fa-box-open" style="color: var(--chat-color);"></i>
                        <h4>Kho Đồ & Sản Phẩm Đã Mua (<span id="inventory-count">0</span>)</h4>
                    </div>
                    
                    <div id="inventory-list" class="inventory-grid">
                        </div>
                    
                    <p id="no-inventory-data" style="text-align: center; color: #888; padding: 20px;">
                        Chưa có sản phẩm nào trong kho. Hãy ghé Shop!
                    </p>
                </div>
                </div>

            <div id="registration-view">
                
                <div class="card registration-card registration-step" id="reg-step-1">
                    <div class="card-header">
                        <i class="fa-solid fa-user-plus"></i>
                        <h4>Đăng Ký Tài Khoản (Bước 1/2)</h4>
                    </div>
                    <form id="registration-form-step1" onsubmit="handleRegistrationStep1(event)">
                        <label for="reg-email-phone">Số điện thoại hoặc Email:</label>
                        <input type="text" id="reg-email-phone" placeholder="Nhập SĐT hoặc Email" required>
                        
                        <label for="reg-password">Mật khẩu:</label>
                        <input type="password" id="reg-password" placeholder="Mật khẩu (ít nhất 6 ký tự)" required>
                        
                        <label for="reg-confirm-password">Xác nhận Mật khẩu:</label>
                        <input type="password" id="reg-confirm-password" placeholder="Xác nhận mật khẩu" required>
                        
                        <button type="submit" class="btn-top-up" style="margin-top: 15px;">TIẾP TỤC</button>
                        <p id="reg-message-1" style="margin-top: 10px; color: red;"></p>
                    </form>
                    
                    <div class="auth-switch-prompt">
                        Đã có tài khoản? <a href="#" onclick="toggleAuthView('login', event)">Đăng nhập ngay!</a>
                    </div>
                </div>

                <div class="card registration-card registration-step" id="reg-step-2" style="display: none;">
                    <div class="card-header">
                        <i class="fa-solid fa-user-check"></i>
                        <h4>Đăng Ký Tài Khoản (Bước 2/2)</h4>
                    </div>
                    <form id="registration-form-step2" onsubmit="handleRegistrationStep2(event)">
                        <label for="reg-username">Tên Tài khoản (Hiển thị):</label>
                        <input type="text" id="reg-username" placeholder="Tên hiển thị" required>
                        
                        <p style="font-size: 0.9em; color: #666;">Thông tin đã nhập: <strong id="summary-email-phone"></strong></p>

                        <button type="button" class="btn-secondary" style="margin-top: 10px;" onclick="showRegistrationStep1()">Quay lại</button>
                        <button type="submit" class="btn-top-up" style="margin-top: 10px;">HOÀN TẤT ĐĂNG KÝ</button>
                        <p id="reg-message-2" style="margin-top: 10px; color: red;"></p>
                    </form>
                </div>

                <div class="card registration-card registration-step" id="login-view" style="display: none;">
                    <div class="card-header">
                        <i class="fa-solid fa-right-to-bracket"></i>
                        <h4>Đăng Nhập Tài Khoản</h4>
                    </div>
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <label for="login-email-phone">Số điện thoại hoặc Email:</label>
                        <input type="text" id="login-email-phone" placeholder="Nhập SĐT hoặc Email" required>
                        
                        <label for="login-password">Mật khẩu:</label>
                        <input type="password" id="login-password" placeholder="Mật khẩu" required>
                        
                        <button type="submit" class="btn-top-up" style="margin-top: 15px;">ĐĂNG NHẬP</button>
                        <p id="login-message" style="margin-top: 10px; color: red;"></p>
                    </form>
                    
                    <div class="auth-switch-prompt">
                        Chưa có tài khoản? <a href="#" onclick="toggleAuthView('register', event)">Đăng ký ngay!</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="server-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeServerDetailModal()">&times;</span>
            <h3 style="text-align: center;"><i class="fa-solid fa-server"></i> Chi tiết Server & Hệ thống</h3>
            
            <div class="server-info-detail">
                <p>
                    <span><i class="fa-solid fa-globe"></i> Tên Server:</span>
                    <strong>VN-A (VietNam Primary)</strong>
                </p>
                <p>
                    <span><i class="fa-solid fa-tachometer-alt"></i> Tốc độ Phản hồi:</span>
                    <strong>~ 120ms (Tốt)</strong>
                </p>
                <p>
                    <span><i class="fa-solid fa-users"></i> Số người dùng đang hoạt động:</span>
                    <strong id="active-user-count">1,250+</strong> 
                </p>
                <p>
                    <span><i class="fa-solid fa-bolt"></i> Trạng thái Hệ thống:</span>
                    <strong class="status-good">ĐANG HOẠT ĐỘNG TỐT</strong>
                </p>
                <p>
                    <span><i class="fa-solid fa-calendar-check"></i> Lịch bảo trì kế hoạch:</span>
                    <strong style="color: var(--support-color);">Chủ Nhật (0h-3h AM)</strong>
                </p>
            </div>

            <p style="text-align: center; margin-top: 20px; font-size: 0.9em; color: #666;">
                Mọi vấn đề về tốc độ giao dịch, vui lòng liên hệ Hỗ trợ!
            </p>
        </div>
    </div>
    <div id="purchase-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h3 id="modal-title">Xác nhận mua hàng</h3>
            
            <div id="modal-details">
                <p>Sản phẩm: <strong id="modal-product-name"></strong></p>
                <p>Giá đơn vị: <span id="modal-unit-price"></span> VNĐ</p>
                <p id="modal-stock-line">Còn lại: <span id="modal-product-stock"></span></p>
            </div>
            
            <div id="quantity-controls">
                <div class="quantity-control">
                    <label for="quantity">Số lượng:</label>
                    <button class="qty-button qty-minus" onclick="changeQuantity(-1)">-</button>
                    <input type="number" id="quantity" value="1" min="1" oninput="updateTotal()">
                    <button class="qty-button qty-plus" onclick="changeQuantity(1)">+</button>
                </div>
            </div>
            
            <div id="time-controls" style="display: none;">
                <label for="purchase-type-select">Chọn gói thời gian:</label>
                <select id="purchase-type-select" onchange="updateTotal()">
                    <option value="30">30 Day (Giá cơ bản)</option>
                    <option value="60">60 Day</option>
                    <option value="90">90 Day</option>
                    <option value="180">180 Day</option>
                    <option value="360">360 Day</option>
                    <option value="perma">Vĩnh viễn (Có BH)</option>
                </select>
            </div>

            <div class="total-info">
                <p>Tổng tiền: <strong id="modal-total-price">0 VNĐ</strong></p>
            </div>

            <button id="confirm-buy-button" onclick="finalizePurchase()">Xác nhận Mua</button>
            <p id="purchase-message" style="margin-top: 15px; color: red;"></p>
        </div>
    </div>

    <div id="topup-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTopUpModal()">&times;</span>
            <h3 style="color: var(--accent-color);"><i class="fa-solid fa-arrow-up-right-from-square"></i> HƯỚNG DẪN CHUYỂN KHOẢN</h3>
            
            <p>Vui lòng chuyển khoản chính xác số tiền:</p> 
            <strong id="topup-amount-display">0 VNĐ</strong>
            
            <div class="transfer-details">
                <div class="copy-info-line">
                    <p>
                        <strong><i class="fa-solid fa-bank"></i>Ngân Hàng:</strong> 
                        <span id="bank-name">MBank(quân đội)</span>
                    </p>
                    <button class="copy-button" onclick="copyToClipboard('bank-name')">
                        <i class="fa-regular fa-copy"></i> Copy
                    </button>
                </div>
                
                <div class="copy-info-line">
                    <p>
                        <strong><i class="fa-solid fa-hashtag"></i> Số tài khoản:</strong> 
                        <span id="bank-account-number">0394539007</span>
                    </p>
                    <button class="copy-button" onclick="copyToClipboard('bank-account-number')">
                        <i class="fa-regular fa-copy"></i> Copy
                    </button>
                </div>
                
                <div class="copy-info-line">
                    <p>
                        <strong><i class="fa-solid fa-user-tie"></i> Chủ tài khoản:</strong> 
                        <span id="account-owner">DINH ANH CHANG</span>
                    </p>
                </div>
                
                <div class="copy-info-line note-important" style="border-top: 1px solid #ccc; padding-top: 10px;">
                    <p>
                        <i class="fa-solid fa-key"></i> Nội Dung Chuyển Khoản Bắt Buộc 
                        <strong id="transfer-code-display" style="animation: none;">IDMMO12345</strong>
                    </p>
                    <button class="copy-button" onclick="copyToClipboard('transfer-code-display')">
                        <i class="fa-regular fa-copy"></i> Copy
                    </button>
                </div>
            </div>
            
            <button class="btn-primary" onclick="confirmTopUp(document.getElementById('topup-amount').value)">Đã Chuyển Khoản</button>
            <button class="btn-cancel" onclick="closeTopUpModal()">Hủy</button>

            <p id="topup-status" style="margin-top: 15px; font-size: 0.9em;"></p>
        </div>
    </div>
    
    <div id="toast-notification">
        <div class="toast-content">
            <i class="fa-solid fa-cart-arrow-down toast-icon"></i>
            <span id="toast-message">Giao dịch thành công!</span>
        </div>
    </div>

    <div class="floating-buttons">
        <a href="#" onclick="toggleChatWidget(event)" class="floating-button chat-button" title="Chat với Bot">
            <i class="fa-regular fa-comments"></i>
        </a>
        <a href="https://t.me/nhatpham27" target="_blank" class="floating-button support-button" title="Hỗ trợ qua Telegram">
            <i class="fa-solid fa-headset"></i>
        </a>
    </div>

    <div id="chat-widget">
        <div class="chat-header">
            <i class="fa-solid fa-robot"></i>
            <span>Bot Hỗ trợ MMO</span>
            <button onclick="toggleChatWidget(event)"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="chat-body" id="chat-messages">
            <div class="message bot"><i class="fa-solid fa-robot bot-icon"></i> Xin chào! Tôi là Bot hỗ trợ. Tôi có thể giúp bạn tìm thông tin về mua tài khoản,nạp tiền hay chính sách bảo hành không?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input-text" placeholder="Nhập câu hỏi của bạn..." onkeydown="handleChatInput(event)">
            <button onclick="sendChatMessage()">
                 <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <div id="welcome-modal">
        <div class="welcome-content">
            <div class="welcome-header">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <h4>CẢNH BÁO QUAN TRỌNG VÀ SỰ KIỆN NỔI BẬT</h4>
            </div>

            <div class="alert-section">
                <p>
                    <i class="fa-solid fa-user-secret" style="color: red;"></i>
                    <strong>CẢNH BÁO LỪA ĐẢO TIKTOK LITE:</strong> Hiện nay, tình trạng sử dụng mã giới thiệu TikTok Lite để lừa đảo và chiếm đoạt tài sản TĂNG CAO. 
                </p>
                <p>
                    <i class="fa-solid fa-shield-alt" style="color: var(--accent-color);"></i>
                    Web chính thức chỉ cung cấp TÀI KHOẢN và SERVICE✅ (Proxy/VPN). ⚠️Tuyệt đối KHÔNG MUA BÁN MÃ GIỚI THIỆU 1:1 hoặc tin vào các tài khoản giá rẻ không rõ nguồn gốc.‼️
                </p>
                <p style="font-weight: bold; color: var(--chat-color);">
                     Mọi giao dịch nên thực hiện qua hệ thống web để đảm bảo an toàn tuyệt đối.
                </p>
            </div>
            
            <div class="event-section">
                <h5><i class="fa-solid fa-bullhorn" style="color: var(--support-color);"></i> SỰ KIỆN & ƯU ĐÃI ĐANG DIỄN RA</h5>
                <ul>
                    <li>Khuyến mãi Nạp tiền: Cộng thêm 10% giá trị nạp vào Ví khi nạp qua 18h-00(Hàng tuần).</li>
                    <li>Giảm giá Sốc: Tài khoản TikTok Lite đang giảm 30% khi mua số lượng lớn.</li>
                    <li>Flash Sale:Tiktok Beta (Kiếm tiền US/EU) giảm 15% cho 10 khách hàng đầu tiên trong tuần!</li>
                </ul>
            </div>

            <button class="btn-understood" onclick="hideWelcomeModal()">
                <i class="fa-solid fa-thumbs-up"></i> TÔI ĐÃ HIỂU VÀ ĐỒNG Ý
            </button>
        </div>
    </div>
    <nav class="navbar">
        <ul class="navbar-list">
            <li class="navbar-item">
                <a href="#" onclick="showSection('menu', this)">
                    <i class="fa-solid fa-house navbar-icon"></i>
                    <span>Menu</span>
                </a>
            </li>
            <li class="navbar-item">
                <a href="#" onclick="showSection('shop', this)">
                    <i class="fa-solid fa-cart-shopping navbar-icon"></i>
                    <span>Shop</span>
                </a>
            </li>
            <li class="navbar-item">
                <a href="#" onclick="showSection('wallet', this)">
                    <i class="fa-solid fa-wallet navbar-icon"></i>
                    <span>Ví</span>
                </a>
            </li>
            <li class="navbar-item">
                <a href="#" onclick="showSection('profile', this)">
                    <i class="fa-solid fa-user navbar-icon"></i>
                    <span>Cá nhân</span>
                </a>
            </li>
        </ul>
    </nav>
    <script>
        // --- DỮ LIỆU MÔ PHỎNG VÀ TRẠNG THÁI NGƯỜI DÙNG ---
        let isUserLoggedIn = false; 
        let userData = {
            username: 'Khách',
            emailPhone: '',
            joinDate: new Date().toLocaleDateString('vi-VN')
        };
        let userBalance = 0; 
        let transactionHistory = [];
        let purchaseHistory = [];
        let currentProduct = { id: null, name: null, price: 0, maxStock: 0, isSubscription: false };
        let tempRegistrationData = {}; 
        
        // Cấu trúc dữ liệu mô phỏng Cơ sở dữ liệu người dùng
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || {}; 
        let userAuthKey = localStorage.getItem('userAuthKey'); // Key của người dùng đang đăng nhập (Email/Phone)


        // --- LOGIC CHUNG ---

        // Định dạng tiền tệ
        function formatCurrency(amount) {
            // Đảm bảo là số, nếu không thì trả về 0
            if (typeof amount !== 'number' || isNaN(amount)) {
                amount = 0;
            }
             // Sử dụng toLocaleString để thêm dấu chấm phân cách hàng nghìn
            return amount.toLocaleString('vi-VN');
        }
        
        // Hàm sao chép nội dung vào clipboard
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            let textToCopy = element.innerText.trim();
            
            // Xử lý loại bỏ các ký tự đặc biệt nếu cần
            if (elementId === 'bank-account-number') {
                 // Loại bỏ khoảng trắng
                 textToCopy = textToCopy.replace(/\s/g, ''); 
            } 
            
            // Sử dụng API Clipboard hiện đại
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Thay đổi tạm thời text của nút
                const button = document.querySelector(`[onclick="copyToClipboard('${elementId}')"]`);
                
                // Nếu không tìm thấy nút (ví dụ cho Chủ tài khoản không có nút), không làm gì
                if (!button) return; 

                const originalHTML = button.innerHTML;
                
                button.innerHTML = '<i class="fa-solid fa-check"></i> Đã Copy';
                button.style.backgroundColor = 'var(--success-color)';
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.style.backgroundColor = 'var(--support-color)';
                }, 1500);
                
                showToast(`Đã sao chép: ${textToCopy}`);
            }).catch(err => {
                console.error('Không thể sao chép: ', err);
                alert('Lỗi: Trình duyệt của bạn không hỗ trợ sao chép tự động. Vui lòng copy thủ công: ' + textToCopy);
            });
        }


        // Hàm hiển thị Toast Notification (ĐÃ TÙY CHỈNH)
        function showToast(message) {
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.querySelector('#toast-notification .toast-icon');

            // Đảm bảo reset về trạng thái mặc định (thành công/nạp tiền)
            toastIcon.className = 'fa-solid fa-circle-check toast-icon';
            toastIcon.style.color = 'var(--success-color)';
            toast.style.backgroundColor = 'white';
            
            toastMessage.innerHTML = message;
            
            toast.classList.add('show');

            setTimeout(function(){ 
                toast.classList.remove('show'); 
            }, 3000);
        }

        // Hàm kiểm tra định dạng Email hoặc Số điện thoại
        function isValidEmailOrPhone(input) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            // Regex cơ bản cho SĐT Việt Nam: 9-11 số
            const phoneRegex = /^(0|\+84)[3|5|7|8|9]\d{8}$/; 

            if (emailRegex.test(input)) {
                return 'email';
            } else if (phoneRegex.test(input)) {
                return 'phone';
            }
            return false;
        }

        // Hàm cập nhật trạng thái nút Gửi đánh giá
        function updateReviewFormState() {
            const reviewButton = document.querySelector('#review-form button');
            if (reviewButton) {
                reviewButton.disabled = !isUserLoggedIn;
                reviewButton.innerText = isUserLoggedIn ? 'Gửi Đánh Giá' : 'Đăng ký để gửi đánh giá';
            }
        }
        
        // Cập nhật trạng thái hiển thị giao diện chính
        function updateGlobalState() {
            const balanceText = isUserLoggedIn ? formatCurrency(userBalance) + ' VNĐ' : 'Chưa liên kết';
            document.getElementById('user-balance').innerText = balanceText;
            const walletBalanceElement = document.getElementById('current-wallet-balance');
            if(walletBalanceElement) walletBalanceElement.innerText = balanceText;

            // Cập nhật trạng thái nút (Khóa/Mở khóa)
            const buyButtons = document.querySelectorAll('.buy-button');
            const topUpButton = document.querySelector('.btn-top-up:not(.logout-button)');
            const menuTopUpButton = document.querySelector('#menu-topup-btn');
            const topupAmountInput = document.getElementById('topup-amount');
            
            buyButtons.forEach(btn => {
                btn.disabled = !isUserLoggedIn;
                btn.innerText = isUserLoggedIn ? 'Mua Ngay' : 'Đăng ký để mua';
            });
            
            if(topUpButton) {
                topUpButton.disabled = !isUserLoggedIn;
                topUpButton.innerText = isUserLoggedIn ? 'NẠP TIỀN' : 'ĐĂNG KÝ';
            }
            if(menuTopUpButton) {
                menuTopUpButton.disabled = !isUserLoggedIn;
                menuTopUpButton.innerText = isUserLoggedIn ? 'Nạp tiền ngay' : 'Đăng ký để nạp';
            }
            
            // Đặt giá trị mặc định cho input nạp tiền
            if (topupAmountInput) {
                // Giữ giá trị 0 nếu chưa đăng nhập hoặc chưa nhập gì
                if (!isUserLoggedIn || topupAmountInput.value === '') {
                    topupAmountInput.value = '0';
                }
            }
            
            updateReviewFormState();

            // Cập nhật giao diện trang Cá nhân/Menu
            const totalPurchases = purchaseHistory.length;
            document.getElementById('welcome-username').innerText = userData.username;
            document.getElementById('total-purchases').innerText = totalPurchases;

            document.getElementById('profile-view').style.display = isUserLoggedIn ? 'block' : 'none';
            document.getElementById('registration-view').style.display = isUserLoggedIn ? 'none' : 'block';

            if (isUserLoggedIn) {
                document.getElementById('display-username').innerText = userData.username;
                document.getElementById('display-email-phone').innerText = userData.emailPhone;
                document.getElementById('display-join-date').innerText = userData.joinDate;
                document.getElementById('display-balance').innerText = formatCurrency(userBalance) + ' VNĐ';
                // Đảm bảo cập nhật kho đồ khi chuyển sang profile
                renderInventory(); 
            }
            
            // Đồng bộ dữ liệu Hot Products trong Menu
            updateHomepageData();
        }
        
        // Hàm cập nhật trạng thái người dùng khi đăng nhập/tải lại
        function loadUserData(authKey) {
            const user = registeredUsers[authKey];
            if (user) {
                isUserLoggedIn = true;
                userData = user.info;
                userBalance = user.balance;
                transactionHistory = user.transactions;
                purchaseHistory = user.purchases;
                userAuthKey = authKey;
                localStorage.setItem('userAuthKey', authKey);
                
                updateGlobalState();
                updateAllStockDisplay();
                return true;
            }
            return false;
        }

        // Hàm lưu dữ liệu hiện tại của người dùng vào LocalStorage
        function saveCurrentUserData() {
            if (isUserLoggedIn && userAuthKey) {
                registeredUsers[userAuthKey].balance = userBalance;
                registeredUsers[userAuthKey].transactions = transactionHistory;
                registeredUsers[userAuthKey].purchases = purchaseHistory;
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            }
        }

        // --- LOGIC ĐĂNG KÝ / ĐĂNG NHẬP / ĐĂNG XUẤT ---
        
        function toggleAuthView(view, event) {
            if (event) event.preventDefault();
            
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('reg-step-1').style.display = 'none';
            document.getElementById('reg-step-2').style.display = 'none';
            
            document.getElementById('login-message').innerText = ''; 

            if (view === 'login') {
                document.getElementById('login-view').style.display = 'block';
            } else {
                showRegistrationStep1();
            }
        }

        function showRegistrationStep1() {
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('reg-step-1').style.display = 'block';
            document.getElementById('reg-step-2').style.display = 'none';
            document.getElementById('reg-message-1').innerText = '';
        }

        function showRegistrationStep2() {
            document.getElementById('reg-step-1').style.display = 'none';
            document.getElementById('reg-step-2').style.display = 'block';
            document.getElementById('reg-message-2').innerText = '';
            document.getElementById('summary-email-phone').innerText = tempRegistrationData.emailPhone;
        }

        function handleRegistrationStep1(event) {
            event.preventDefault();
            const emailPhone = document.getElementById('reg-email-phone').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const messageEl = document.getElementById('reg-message-1');
            const authKey = emailPhone.toLowerCase(); // Chuẩn hóa key

            if (registeredUsers[authKey]) {
                messageEl.innerText = 'Lỗi: Tài khoản này đã tồn tại. Vui lòng Đăng nhập.';
                return;
            }
            if (password !== confirmPassword) {
                messageEl.innerText = 'Lỗi: Mật khẩu xác nhận không khớp.';
                return;
            }
            if (password.length < 6) {
                 messageEl.innerText = 'Lỗi: Mật khẩu phải có ít nhất 6 ký tự.';
                return;
            }
            if (!isValidEmailOrPhone(emailPhone)) {
                 messageEl.innerText = 'Lỗi: Vui lòng nhập đúng định dạng Email hoặc SĐT VN.';
                return;
            }

            tempRegistrationData = { emailPhone, password, authKey };
            messageEl.innerText = '';
            showRegistrationStep2();
        }

        function handleRegistrationStep2(event) {
            event.preventDefault();
            const username = document.getElementById('reg-username').value.trim();
            const messageEl = document.getElementById('reg-message-2');

            if (username.length < 3) {
                 messageEl.innerText = 'Lỗi: Tên tài khoản phải có ít nhất 3 ký tự.';
                return;
            }

            // 1. Khởi tạo dữ liệu người dùng mới
            const newUserData = {
                info: {
                    username: username,
                    emailPhone: tempRegistrationData.emailPhone,
                    joinDate: new Date().toLocaleDateString('vi-VN'),
                    password: tempRegistrationData.password
                },
                balance: 0,
                transactions: [],
                purchases: []
            };

            // 2. Lưu vào "Cơ sở dữ liệu" (localStorage)
            registeredUsers[tempRegistrationData.authKey] = newUserData;
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

            // 3. Đăng nhập ngay lập tức
            loadUserData(tempRegistrationData.authKey);
            
            showToast(`✅ Chào mừng ${username}! Đăng ký thành công.`);
            
            showSection('profile', document.querySelector('.navbar-item:nth-child(4) a'));
        }

        function handleLogin(event) {
            event.preventDefault();
            const emailPhone = document.getElementById('login-email-phone').value.trim();
            const password = document.getElementById('login-password').value;
            const messageEl = document.getElementById('login-message');
            const authKey = emailPhone.toLowerCase();
            
            const user = registeredUsers[authKey];

            if (!user) {
                messageEl.innerText = 'Lỗi: Tài khoản không tồn tại. Vui lòng kiểm tra lại Email/SĐT.';
                return;
            }

            if (user.info.password !== password) {
                messageEl.innerText = 'Lỗi: Mật khẩu không chính xác.';
                return;
            }

            // Đăng nhập thành công
            loadUserData(authKey);
            
            showToast(`✅ Chào mừng trở lại, ${userData.username}!`);
            messageEl.innerText = '';
            
            // Chuyển về trang Menu
            showSection('menu', document.querySelector('.navbar-item:nth-child(1) a'));
        }


        function logoutUser() {
            saveCurrentUserData(); // Lưu dữ liệu trước khi đăng xuất
            isUserLoggedIn = false;
            userAuthKey = null;
            localStorage.removeItem('userAuthKey');
            
            // Đặt lại trạng thái mặc định
            userData = { username: 'Khách', emailPhone: '', joinDate: new Date().toLocaleDateString('vi-VN') };
            userBalance = 0;
            transactionHistory = [];
            purchaseHistory = [];
            
            showToast('👋 Đã đăng xuất khỏi tài khoản.');
            updateGlobalState();
            updateAllStockDisplay();
            showSection('menu', document.querySelector('.navbar-item:nth-child(1) a'));
        }

        // --- LOGIC SHOP (MUA HÀNG) ---

        // Hàm hiển thị tồn kho (sử dụng 99+ cho số lượng lớn)
        function displayStock(stock) {
            if (stock === 9999) return "Không giới hạn";
            return stock > 99 ? "99+" : stock;
        }
        
        // Cấu hình giá gói thời gian (tỉ lệ phần trăm so với giá cơ bản 30 day)
        const subscriptionPricing = {
            'tiktok-lite': { 30: 1, 60: 1.8, 90: 2.5, 180: 4, 360: 7, perma: 15 },
            'gogo-lite':   { 30: 1, 60: 1.7, 90: 2.3, 180: 3.8, 360: 6.5, perma: 13 },
            'tool-reg':    { 30: 1, 90: 2.5, 180: 4.5, 360: 8 }, // Mới: Auto Reg
            'bot-server':  { 30: 1, 90: 2.8, 180: 5, 360: 9 } // Mới: Bot Server
        };

        // Hàm tính giá dựa trên thời gian
        function calculateSubscriptionPrice(basePrice, daysKey) {
            const product = currentProduct.id;
            if (subscriptionPricing[product] && subscriptionPricing[product][daysKey]) {
                return Math.round(basePrice * subscriptionPricing[product][daysKey]);
            }
            return basePrice; // Mặc định nếu không tìm thấy
        }

        // Hàm cập nhật số lượng trong modal (dấu +/-)
        function changeQuantity(delta) {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value) || 0;
            let newQuantity = quantity + delta;
            
            const maxStock = currentProduct.maxStock === 9999 ? 9999 : currentProduct.maxStock;

            if (newQuantity < 1) newQuantity = 1;
            if (newQuantity > maxStock) newQuantity = maxStock;
            
            quantityInput.value = newQuantity;
            updateTotal();
        }

        // Mở Popup xác nhận mua hàng
        function openModal(id, name, basePrice, stock, isSubscription) {
            if (!isUserLoggedIn) {
                showToast('🔒 Vui lòng Đăng ký tài khoản để mua hàng.');
                showSection('profile', document.querySelector('.navbar-item:nth-child(4) a'));
                return;
            }
            
            let actualStock = stock;
            const stockElement = document.getElementById(`stock-${id}`);
            if (stockElement) {
                const text = stockElement.innerText;
                if (text.includes('Hết hàng')) {
                    actualStock = 0;
                } else if (text.includes('CÓ HẠN')) {
                    const match = text.match(/\d+$/);
                    actualStock = match ? parseInt(match[0]) : 50;
                } else if (text.includes(':')) {
                    const stockText = text.split(':').pop().trim().replace('+', '');
                    actualStock = isNaN(parseInt(stockText)) ? 9999 : parseInt(stockText);
                }
            }
            
            currentProduct = { id, name, basePrice, maxStock: actualStock, isSubscription: isSubscription };

            document.getElementById('modal-product-name').innerText = name;
            document.getElementById('modal-unit-price').innerText = formatCurrency(basePrice);
            document.getElementById('modal-stock-line').style.display = isSubscription ? 'none' : 'block';
            document.getElementById('modal-product-stock').innerText = displayStock(actualStock);
            
            // Hiển thị/Ẩn controls
            document.getElementById('quantity-controls').style.display = isSubscription ? 'none' : 'block';
            document.getElementById('time-controls').style.display = isSubscription ? 'block' : 'none';

            // Reset và cập nhật giá trị
            const quantityInput = document.getElementById('quantity');
            quantityInput.value = 1;
            quantityInput.max = actualStock;
            
            if(isSubscription) {
                 document.getElementById('purchase-type-select').value = 30; // Mặc định 30 ngày
            }
            
            document.getElementById('purchase-message').innerText = '';
            document.getElementById('purchase-message').style.color = 'red';
            document.getElementById('confirm-buy-button').disabled = false;
            
            updateTotal();
            document.getElementById('purchase-modal').style.display = 'block';
        }

        // Đóng Popup
        function closeModal() {
            document.getElementById('purchase-modal').style.display = 'none';
        }

        // Cập nhật Tổng tiền khi số lượng thay đổi
        function updateTotal() {
            let total = 0;
            let purchaseMessage = document.getElementById('purchase-message');

            if (currentProduct.isSubscription) {
                // Logic mua theo thời gian (Số lượng luôn là 1)
                const daysKey = document.getElementById('purchase-type-select').value;
                total = calculateSubscriptionPrice(currentProduct.basePrice, daysKey);
                currentProduct.finalQuantity = 1;
                currentProduct.purchaseDetails = daysKey === 'perma' ? 'Vĩnh viễn' : `${daysKey} Ngày`;

            } else {
                // Logic mua theo số lượng
                const quantityInput = document.getElementById('quantity');
                let quantity = parseInt(quantityInput.value) || 0;
                const maxStock = currentProduct.maxStock;

                if (quantity > maxStock && maxStock !== 9999) {
                    quantity = maxStock;
                    quantityInput.value = maxStock;
                }
                if (quantity < 1) quantity = 1;

                total = quantity * currentProduct.basePrice;
                currentProduct.finalQuantity = quantity;
                currentProduct.purchaseDetails = `x${quantity}`;
            }
            
            document.getElementById('modal-total-price').innerText = formatCurrency(total) + ' VNĐ';

            // Kiểm tra điều kiện mua
            if (total > userBalance) {
                 purchaseMessage.innerText = 'Lỗi: Số dư tài khoản không đủ.';
                 document.getElementById('confirm-buy-button').disabled = true;
            } else if (currentProduct.maxStock === 0) {
                 purchaseMessage.innerText = 'Sản phẩm đã hết hàng.';
                 document.getElementById('confirm-buy-button').disabled = true;
            } else if (currentProduct.finalQuantity < 1) {
                 purchaseMessage.innerText = 'Lỗi: Số lượng/Gói thời gian không hợp lệ.';
                 document.getElementById('confirm-buy-button').disabled = true;
            } else {
                purchaseMessage.innerText = '';
                document.getElementById('confirm-buy-button').disabled = false;
            }
        }

        // Xử lý mua hàng sau khi xác nhận
        function finalizePurchase() {
            const quantity = currentProduct.finalQuantity;
            // Lấy tổng tiền bằng cách loại bỏ dấu phân cách VNĐ và chuyển sang số
            const totalCostText = document.getElementById('modal-total-price').innerText.replace(/\./g, '').replace(' VNĐ', '');
            const totalCost = parseInt(totalCostText) || 0;
            const purchaseMessage = document.getElementById('purchase-message');

            if (totalCost > userBalance) {
                purchaseMessage.innerText = 'Lỗi: Số dư tài khoản không đủ. Vui lòng nạp thêm tiền.';
                return;
            }
            if (currentProduct.maxStock === 0) {
                purchaseMessage.innerText = 'Lỗi: Sản phẩm đã hết hàng.';
                return;
            }

            // 1. Tiến hành giao dịch (MÔ PHỎNG)
            userBalance -= totalCost;
            
            // 2. Thêm giao dịch và mua hàng vào lịch sử
            const date = new Date().toISOString().slice(0, 10);
            transactionHistory.push({ type: 'Thanh toán', amount: -totalCost, date: date, status: 'Hoàn thành' });
            purchaseHistory.push({ 
                id: purchaseHistory.length + 1, 
                product: currentProduct.name, 
                quantity: quantity, 
                total: totalCost, 
                date: date, 
                details: currentProduct.isSubscription ? currentProduct.purchaseDetails : `x${quantity}`,
                status: 'Đã giao' 
            });
            
            // 3. Cập nhật số lượng còn hàng (TRỪ TỒN KHO)
            if (!currentProduct.isSubscription && currentProduct.maxStock !== 9999) {
                currentProduct.maxStock -= quantity;
                
                // MÔ PHỎNG: Cập nhật lại tồn kho trong object cứng (Chỉ cho mục đích demo)
                const shopStockUpdates = {
                    'tiktok-beta': 50, 'gmail-old': 500, 'twitter-verified': 15, 'fb-old': 20, 'tiktok-new': 20000, 'tele-trust': 150
                };
                if (shopStockUpdates.hasOwnProperty(currentProduct.id)) {
                    shopStockUpdates[currentProduct.id] = currentProduct.maxStock;
                }
            }
            
            // 4. Cập nhật DOM
            updateAllDisplay();
            
            // 5. Thông báo thành công và đóng modal
            showToast(`✅ Mua ${currentProduct.name} (${currentProduct.purchaseDetails}) thành công!`);
            closeModal();
            saveCurrentUserData(); // Lưu dữ liệu sau khi mua
        }

        // --- LOGIC VÍ (WALLET) ---
        
        // Hàm tạo chuỗi ngẫu nhiên 10 ký tự
        function generateRandomCode(length) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }


        // Mở modal Nạp tiền
        function showTopUpModal() {
            if (!isUserLoggedIn) {
                showToast('🔒 Vui lòng Đăng ký tài khoản để nạp tiền.');
                showSection('profile', document.querySelector('.navbar-item:nth-child(4) a'));
                return;
            }
            
            const topUpAmountInput = document.getElementById('topup-amount');
            const amount = parseInt(topUpAmountInput.value) || 0;

            if (amount < 10000) {
                showToast(`❌ Lỗi: Số tiền nạp tối thiểu là 10.000 VNĐ.`);
                return;
            }

            document.getElementById('topup-amount-display').innerText = formatCurrency(amount) + ' VNĐ';
            
            // [CẬP NHẬT] Tạo nội dung chuyển khoản ngẫu nhiên (10 ký tự)
            const transferCode = 'MMO' + generateRandomCode(7); 
            document.getElementById('transfer-code-display').innerText = transferCode;
            
            document.getElementById('topup-status').innerText = '';
            
            // Thêm class để kích hoạt animation modal
            const topupModal = document.getElementById('topup-modal');
            topupModal.style.display = 'block';
            setTimeout(() => { topupModal.classList.add('show-modal'); }, 10);
        }

        // Đóng modal Nạp tiền
        function closeTopUpModal() {
            const topupModal = document.getElementById('topup-modal');
            topupModal.classList.remove('show-modal');
            setTimeout(() => { topupModal.style.display = 'none'; }, 400); // Đợi animation kết thúc
        }

        // Xử lý xác nhận nạp tiền (Mô phỏng - ĐÃ SỬA THÀNH THẤT BẠI)
        function confirmTopUp(amountStr) {
            const amount = parseInt(amountStr) || 0;
            const topupStatusEl = document.getElementById('topup-status');
            
            topupStatusEl.style.color = 'orange';
            topupStatusEl.innerText = '⏳ Đang kiểm tra giao dịch, vui lòng chờ...';

            setTimeout(() => {
                
                // MÔ PHỎNG KỊCH BẢN THẤT BẠI: KHÔNG CỘNG TIỀN
                
                // Tạo một bản ghi giao dịch (vẫn là thất bại)
                const date = new Date().toISOString().slice(0, 10);
                transactionHistory.push({ 
                    type: `Nạp tiền (Thất bại)`, 
                    amount: 0, 
                    date: date, 
                    status: 'Thất bại' // Cập nhật trạng thái
                });
                
                updateAllDisplay();
                saveCurrentUserData(); // Vẫn lưu lịch sử giao dịch thất bại
                
                // Thông báo thất bại
                topupStatusEl.style.color = 'red';
                topupStatusEl.innerText = `❌ Lỗi: Nạp tiền không thành công. Bạn chưa thanh toán qua hóa đơn ${document.getElementById('transfer-code-display').innerText}. Vui lòng thực hiện chuyển khoản để hệ thống ghi nhận.`;
                showToast(`❌ Nạp tiền thất bại: Vui lòng thanh toán qua hóa đơn.`);

            }, 3000); // Tăng thời gian chờ lên 3 giây cho giống xử lý lỗi
        }

        // Hàm chuyển đổi Tab Lịch sử
        function showHistoryTab(tabId, clickedButton) {
            document.querySelectorAll('.history-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            const targetContainer = document.getElementById(tabId + '-history');
            if (targetContainer) {
                 targetContainer.style.display = 'block';
            }
            
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            if (tabId === 'transactions') {
                renderTransactionHistory();
            } else if (tabId === 'purchases') {
                renderPurchaseHistory();
            }
        }

        // [GIỮ NGUYÊN] Hàm đổ dữ liệu Lịch sử Giao dịch (Sử dụng Table)
        function renderTransactionHistory() {
            const container = document.getElementById('transactions-history');
            container.innerHTML = '';
            
            if (!isUserLoggedIn || transactionHistory.length === 0) {
                container.innerHTML = `<p id="no-transaction-data" style="padding: 15px;">${isUserLoggedIn ? 'Chưa có giao dịch nào.' : 'Vui lòng đăng ký để xem lịch sử.'}</p>`;
                return;
            }
            
            transactionHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            let tableHTML = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-calendar-alt"></i> Ngày</th>
                            <th><i class="fa-solid fa-list-ul"></i> Loại giao dịch</th>
                            <th style="text-align: right;"><i class="fa-solid fa-coins"></i> Số tiền (VNĐ)</th>
                            <th><i class="fa-solid fa-check"></i> Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            transactionHistory.forEach(item => {
                const amountDisplay = item.amount > 0 ? `+${formatCurrency(item.amount)}` : `-${formatCurrency(Math.abs(item.amount))}`;
                const amountClass = item.amount > 0 ? 'amount-plus' : 'amount-minus';
                
                let statusBadge;
                if (item.status === 'Hoàn thành') {
                    statusBadge = `<span class="status-badge status-complete">${item.status}</span>`;
                } else if (item.status === 'Thất bại') {
                    statusBadge = `<span class="status-badge" style="background-color: rgba(255, 0, 0, 0.15); color: red;">${item.status}</span>`;
                } else {
                    statusBadge = `<span class="status-badge status-complete">${item.status}</span>`;
                }
                
                
                tableHTML += `
                    <tr>
                        <td>${item.date}</td>
                        <td class="transaction-type">${item.type}</td>
                        <td class="text-right ${amountClass}" style="text-align: right;">${amountDisplay}</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            container.innerHTML = tableHTML;
        }

        // [GIỮ NGUYÊN] Hàm đổ dữ liệu Lịch sử Mua hàng (Sử dụng Table)
        function renderPurchaseHistory() {
            const container = document.getElementById('purchases-history');
            container.innerHTML = '';
            
            if (!isUserLoggedIn || purchaseHistory.length === 0) {
                container.innerHTML = `<p id="no-purchase-data" style="padding: 15px;">${isUserLoggedIn ? 'Chưa có đơn hàng nào.' : 'Vui lòng đăng ký để xem lịch sử.'}</p>`;
                return;
            }
            
            purchaseHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

            let tableHTML = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-hashtag"></i> ID</th>
                            <th><i class="fa-solid fa-gift"></i> Sản phẩm</th>
                            <th><i class="fa-solid fa-sort-numeric-up"></i> Chi tiết</th>
                            <th style="text-align: right;"><i class="fa-solid fa-money-bill-wave"></i> Tổng tiền (VNĐ)</th>
                            <th><i class="fa-solid fa-check"></i> Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            purchaseHistory.forEach(item => {
                const details = item.details || `x${item.quantity}`;
                const statusBadge = `<span class="status-badge status-delivered">Đã giao</span>`;
                
                tableHTML += `
                    <tr>
                        <td>#${item.id}</td>
                        <td>${item.product}</td>
                        <td>${details}</td>
                        <td class="text-right amount-minus" style="text-align: right;">-${formatCurrency(item.total)}</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;
            container.innerHTML = tableHTML;
        }
        
        // [THÊM MỚI] Hàm lấy Icon dựa trên tên sản phẩm
        function getProductIcon(productName) {
             if (productName.includes('TikTok Lite')) return 'fa-brands fa-tiktok';
             if (productName.includes('Gogo Lite')) return 'fa-solid fa-user-check';
             if (productName.includes('Tiktok Beta')) return 'fa-solid fa-sack-dollar';
             if (productName.includes('VPN')) return 'fa-solid fa-shield-halved';
             if (productName.includes('Proxy')) return 'fa-solid fa-server';
             if (productName.includes('Gmail')) return 'fa-brands fa-google';
             if (productName.includes('FB Cổ')) return 'fa-brands fa-facebook';
             if (productName.includes('X Verified')) return 'fa-brands fa-square-x-twitter';
             if (productName.includes('Tool Auto Reg')) return 'fa-solid fa-wrench';
             if (productName.includes('Bot Tương tác')) return 'fa-solid fa-robot';
             if (productName.includes('Ebook')) return 'fa-solid fa-graduation-cap';
             if (productName.includes('Unlock')) return 'fa-solid fa-lock-open';
             if (productName.includes('Tele')) return 'fa-brands fa-telegram';
             return 'fa-solid fa-box-open';
        }
        
        // [THÊM MỚI] Hàm đổ dữ liệu Kho đồ (Dạng Grid)
        function renderInventory() {
            const container = document.getElementById('inventory-list');
            const noDataMessage = document.getElementById('no-inventory-data');
            const inventoryCount = document.getElementById('inventory-count');
            container.innerHTML = '';
            
            if (!isUserLoggedIn || purchaseHistory.length === 0) {
                container.style.display = 'none';
                noDataMessage.style.display = 'block';
                inventoryCount.innerText = '0';
                return;
            }

            container.style.display = 'grid';
            noDataMessage.style.display = 'none';
            inventoryCount.innerText = purchaseHistory.length;
            
            // Xử lý logic hiển thị
            purchaseHistory.forEach(item => {
                const isSubscription = item.details.includes('Ngày') || item.details.includes('Vĩnh viễn');
                
                // MÔ PHỎNG: Tính trạng thái (Giả định gói 30/60/90 ngày sẽ HẾT HẠN)
                let statusBadge = 'ĐÃ GIAO';
                let statusClass = '';
                let actionText = 'Xem chi tiết';
                let actionColor = '';
                
                if (isSubscription && item.id % 3 === 0 && item.details.includes('30 Day')) { // Giả định một số gói 30 ngày đã hết hạn
                    statusBadge = 'HẾT HẠN';
                    statusClass = 'expired';
                    actionText = 'Gia hạn';
                    actionColor = 'red';
                } else if (item.details.includes('Vĩnh viễn')) {
                    statusBadge = 'VĨNH VIỄN';
                }

                const icon = getProductIcon(item.product);
                
                const itemHTML = `
                    <div class="inventory-item-card">
                        <span class="item-status ${statusClass}">${statusBadge}</span>
                        <div class="item-header">
                            <i class="${icon}"></i>
                            <h5>${item.product}</h5>
                        </div>
                        <div class="item-details">
                            <p>
                                <span><i class="fa-solid fa-list-check"></i> Chi tiết:</span>
                                <strong>${item.details}</strong>
                            </p>
                            <p>
                                <span><i class="fa-solid fa-calendar-check"></i> Ngày mua:</span>
                                <span>${item.date}</span>
                            </p>
                            <p>
                                <span><i class="fa-solid fa-file-invoice-dollar"></i> Tổng tiền:</span>
                                <strong style="color: var(--chat-color);">${formatCurrency(item.total)} VNĐ</strong>
                            </p>
                            <p>
                                <span><i class="fa-solid fa-database"></i> Tài khoản/Key:</span>
                                <strong><a href="#" style="color: var(--support-color); text-decoration: none;">[Bấm để lấy]</a></strong>
                            </p>
                        </div>
                        <div class="item-actions">
                             <button class="btn-item-action">
                                 <i class="fa-solid fa-download"></i> Tải về
                             </button>
                             <button class="btn-item-action ${actionColor}">
                                 <i class="fa-solid fa-arrow-circle-right"></i> ${actionText}
                             </button>
                        </div>
                    </div>
                `;
                container.innerHTML += itemHTML;
            });
        }
        
        // Hàm tạo số người dùng ngẫu nhiên (luôn trên 100)
        function generateRandomActiveUsers() {
            // Ngẫu nhiên từ 150 đến 2500 người
            const minUsers = 150; 
            const maxUsers = 2500;
            return Math.floor(Math.random() * (maxUsers - minUsers + 1)) + minUsers;
        }

        // Mở Modal Chi tiết Server (ĐÃ CẬP NHẬT LOGIC SỐ LIỆU ĐỘNG)
        function showServerDetailModal() {
            const activeUsers = generateRandomActiveUsers();
            
            // Cập nhật số liệu người dùng đang hoạt động trong modal
            const userCountElement = document.getElementById('active-user-count');
            if (userCountElement) {
                userCountElement.innerText = formatCurrency(activeUsers) + '+';
            }
            
            document.getElementById('server-detail-modal').style.display = 'block';
        }

        // Đóng Modal Chi tiết Server
        function closeServerDetailModal() {
            document.getElementById('server-detail-modal').style.display = 'none';
        }

        // Hàm ẩn Modal Chào mừng
        function hideWelcomeModal() {
            document.getElementById('welcome-modal').classList.remove('show');
            // Đặt cờ vào localStorage để không hiện lại
            localStorage.setItem('hasSeenWelcomeModal', 'true'); 
        }

        // Hàm hiển thị Modal Chào mừng (chỉ lần đầu)
        function showWelcomeModal() {
            const hasSeen = localStorage.getItem('hasSeenWelcomeModal');
            if (!hasSeen) {
                document.getElementById('welcome-modal').classList.add('show');
            }
        }

        // Hàm cập nhật toàn bộ hiển thị DOM
        function updateAllDisplay() {
            updateGlobalState(); 
            updateAllStockDisplay();
            
            const transactionContainer = document.getElementById('transactions-history');
            if (transactionContainer && transactionContainer.style.display !== 'none') { renderTransactionHistory(); }
            const purchaseContainer = document.getElementById('purchases-history');
            if (purchaseContainer && purchaseContainer.style.display !== 'none') { renderPurchaseHistory(); }
            
            // Đảm bảo tab lịch sử hiển thị
            const activeTabButton = document.querySelector('.wallet-page .tab-button.active');
            if (activeTabButton) {
                const tabIdMatch = activeTabButton.getAttribute('onclick').match(/'(.*?)'/);
                if (tabIdMatch) {
                    showHistoryTab(tabIdMatch[1], activeTabButton);
                }
            } else {
                 showHistoryTab('transactions', document.querySelector('.wallet-page .tab-button'));
            }
            
            // THÊM: Cập nhật Kho Đồ
            if (document.getElementById('profile-view').style.display === 'block') {
                 renderInventory();
            }
        }

        // Hàm cập nhật các mục Hot Products trên trang Menu
        function updateHomepageData() {
            // Lấy dữ liệu tồn kho hiện tại
            const stockData = {
                'tiktok-lite': document.getElementById('stock-tiktok-lite') ? document.getElementById('stock-tiktok-lite').innerText.replace('Còn hàng: ', '').replace('+', '') : 1000,
                'gogo-lite': document.getElementById('stock-gogo-lite') ? document.getElementById('stock-gogo-lite').innerText.replace('Còn hàng: ', '').replace('+', '') : 850,
                'tiktok-beta': document.getElementById('stock-tiktok-beta') ? document.getElementById('stock-tiktok-beta').innerText.split(':').pop().trim() : 50,
            };

            // Cập nhật các giá trị trong List Hot Products
            if(document.getElementById('hot-stock-tiktok-lite')) {
                 document.getElementById('hot-stock-tiktok-lite').innerText = stockData['tiktok-lite'] === 'Không giới hạn' ? 'Không giới hạn' : displayStock(parseInt(stockData['tiktok-lite']) || 1000);
            }
            if(document.getElementById('hot-stock-gogo-lite')) {
                 document.getElementById('hot-stock-gogo-lite').innerText = stockData['gogo-lite'] === 'Không giới hạn' ? 'Không giới hạn' : displayStock(parseInt(stockData['gogo-lite']) || 850);
            }
            if(document.getElementById('hot-stock-tiktok-beta')) {
                 document.getElementById('hot-stock-tiktok-beta').innerText = stockData['tiktok-beta'];
            }
        }
        
        // Hàm cập nhật tất cả các vị trí hiển thị số lượng tồn kho (ĐÃ CẬP NHẬT)
        function updateAllStockDisplay() {
            // Lưu ý: Trong môi trường thực, các giá trị này sẽ được lấy từ server
            const shopStock = {
                'tiktok-lite': 1000, 
                'gogo-lite': 850,
                'tiktok-beta': 50,
                'vpn-quality': 9999,
                'proxy-quality': 9999,
                'gmail-old': 500,       
                'twitter-verified': 15, 
                'tool-reg': 9999,       
                'unlock-service': 9999,
                // SẢN PHẨM MỚI
                'fb-old': 20,           
                'tiktok-new': 20000,    
                'tut-dam': 9999,        
                'tele-trust': 150,      
                'bot-server': 9999,     
                'buff-service': 9999    
            };
            
            // Cập nhật tồn kho thực tế nếu đã có giao dịch (dùng giá trị maxStock của currentProduct)
            if (currentProduct.id && currentProduct.maxStock !== 0 && shopStock.hasOwnProperty(currentProduct.id)) {
                 // Ghi đè giá trị stock của sản phẩm đang được mua/cập nhật
                 shopStock[currentProduct.id] = currentProduct.maxStock;
            }
            
            for (const id in shopStock) {
                const stock = shopStock[id];
                const element = document.getElementById(`stock-${id}`);
                
                if (element) {
                     if (id === 'tiktok-beta' || id === 'twitter-verified' || id === 'fb-old') {
                        element.innerText = stock > 0 ? `SỐ LƯỢNG CÓ HẠN: ${stock}` : `HẾT HÀNG`;
                    } else if (id === 'tiktok-lite' || id === 'gogo-lite') {
                         element.innerText = `Còn hàng: Không giới hạn`;
                    } else if (id === 'tiktok-new') {
                         element.innerText = `Tồn kho: ${stock}+`;
                    } else if (id === 'gmail-old') {
                         element.innerText = stock > 0 ? `Còn hàng: ${stock}+` : `HẾT HÀNG`;
                    } else if (id === 'tool-reg' || id === 'bot-server') {
                         element.innerText = `License: 1 Tháng`;
                    } else if (id === 'tut-dam') {
                         element.innerText = `Bản quyền: Trọn đời`;
                    } else if (id === 'tele-trust') {
                         element.innerText = stock > 0 ? `Còn hàng: ${stock}` : `HẾT HÀNG`;
                    } else if (id === 'unlock-service') {
                         element.innerText = `Cam kết: Hoàn tiền 100%`;
                    } else if (id === 'buff-service') {
                         element.innerText = `Giá: Tùy gói`;
                    } else { // VPN/Proxy
                        element.innerText = stock === 0 ? `Hết hàng` : `Duy trì: 1 Tháng`;
                    }
                }
            }
            
            // Cập nhật lại dữ liệu Menu sau khi cập nhật Shop
            updateHomepageData();
        }

        // --- LOGIC ĐÁNH GIÁ (REVIEWS) ---
        
        // Hàm cập nhật trạng thái sao khi click
        function setRating(rating) {
            document.getElementById('selected-rating').value = rating;
            const stars = document.querySelectorAll('#star-rating i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('fa-regular');
                    star.classList.add('fa-solid');
                    star.style.color = 'gold';
                } else {
                    star.classList.remove('fa-solid');
                    star.classList.add('fa-regular');
                    star.style.color = 'lightgray';
                }
            });
        }
        
        // Xử lý gửi đánh giá (Mô phỏng)
        function handleReviewSubmit(event) {
            event.preventDefault();
            
            if (!isUserLoggedIn) {
                 showToast('🔒 Vui lòng Đăng nhập/Đăng ký để gửi đánh giá.');
                 showSection('profile', document.querySelector('.navbar-item:nth-child(4) a'));
                 return;
            }

            const rating = document.getElementById('selected-rating').value;
            const comment = document.getElementById('review-comment').value.trim();
            const formMessageEl = document.getElementById('review-message');

            if (comment.length < 10) {
                formMessageEl.style.color = 'red';
                formMessageEl.innerText = 'Bình luận phải có ít nhất 10 ký tự để được duyệt.';
                return;
            }

            // MÔ PHỎNG gửi thành công
            formMessageEl.style.color = 'var(--success-color)';
            formMessageEl.innerText = `✅ Cảm ơn ${userData.username}! Đánh giá ${rating} sao của bạn đã được ghi nhận và đang chờ duyệt.`;
            showToast(`⭐ Gửi đánh giá thành công!`);
            
            // Reset form
            document.getElementById('review-comment').value = '';
            setRating(5); // Reset về 5 sao
            
            // Vô hiệu hóa nút để tránh spam (trong môi trường thực tế)
            document.querySelector('#review-form button').disabled = true;

            // Kích hoạt lại nút sau 5 giây
            setTimeout(() => {
                document.querySelector('#review-form button').disabled = false;
            }, 5000);
        }

        // --- LOGIC SALES TICKER & PROMO NỔI BẬT (Giữ nguyên) ---
        
        const salesData = [
            { user: "Anh**Minh", product: "FB Cổ (5-10 Năm)" },
            { user: "Chi**Loan", product: "Tool Auto Reg" },
            { user: "Khach**VIP", product: "Bot Tương tác Server" },
            { user: "User**199", product: "X Verified" },
            { user: "Dat**Coder", product: "Dịch vụ Unlock Acc" },
            { user: "Hot**Girl", product: "Telegram Trust" }
        ];

        const promoMessages = [
            `🔥🔥 <span class="ticker-highlight">TIKTOK LITE</span> đang giảm 30% khi mua từ 100 tài khoản trở lên! Mua ngay!`,
            `✨ Chú ý: Tài khoản <span class="ticker-highlight">GOGO LITE</span> chỉ còn 120K/acc. Chương trình áp dụng 48H!`,
            `🏷️ SALE KHỦNG: Mua gói thuê bao <span class="ticker-highlight">TikTok Lite Vĩnh viễn</span> TẶNG kèm 1 tháng VPN!`,
            `🌟 Khuyến mãi độc quyền: Giảm 20% khi mua cùng lúc <span class="ticker-highlight">TikTok Lite</span> và Proxy IP VN!`,
            `🔔 Khách hàng mới: Nhận ưu đãi 10% khi mua lần đầu bất kỳ tài khoản Lite nào!`
        ];

        function createSalesTickerContent() {
            const container = document.getElementById('sales-ticker-content');
            let content = '';
            
            for (let i = 0; i < 15; i++) { 
                if (Math.random() < 0.90) { 
                    const promo = promoMessages[Math.floor(Math.random() * promoMessages.length)];
                    content += `<span class="ticker-item"><i class="fa-solid fa-triangle-exclamation" style="color: #ff0077;"></i> ${promo}</span>`;
                } else {
                    const item = salesData[Math.floor(Math.random() * salesData.length)];
                    const time = Math.floor(Math.random() * 10) + 1; 
                    content += `
                        <span class="ticker-item">
                            <i class="fa-solid fa-check-double"></i> 
                            <strong>${item.user}</strong> vừa mua <span class="ticker-highlight">**${item.product}**</span> - ${time} phút trước!
                        </span>
                    `;
                }
            }
            container.innerHTML = content + content + content + content;
        }
        
        const promotionList = [
            { text: 'Sốc! Tài khoản **TikTok Lite** giảm **30%** khi mua SLL!', action: "showSection('shop', document.querySelector('.navbar-item:nth-child(2) a'))" },
            { text: 'Ưu đãi: **Tiktok Beta (Kiếm tiền)** giảm giá 15% cho 10 khách đầu tiên!', action: "openModal('tiktok-beta', 'Tiktok Beta (Kiếm tiền)', 1500000, 50, false)" },
            { text: '🔥 Độc quyền: Mua **FB Cổ (Trust)** TẶNG kèm 1 tháng VPN!', action: "openModal('fb-old', 'Tài khoản FB Cổ', 1800000, 20, false)" },
            { text: 'GIẢM SÂU: **Tool Auto Reg** giảm 20% License 1 Tháng!', action: "openModal('tool-reg', 'Tool Auto Reg', 499000, 9999, true)" },
            { text: 'Hấp dẫn: **Tài khoản Gogo Lite** mua 50 TẶNG 5!', action: "openModal('gogo-lite', 'Tài khoản Gogo Lite', 120000, 9999, true)" }
        ];
        
        let currentPromoIndex = 0;
        const promoDisplayDuration = 6000; 
        const promoInterval = 60000;      
        
        function updateFloatingNotification() {
            const notificationEl = document.getElementById('promo-notification');
            const promo = promotionList[currentPromoIndex];

            notificationEl.classList.remove('show');

            setTimeout(() => {
                const textSpan = notificationEl.querySelector('.notification-text');
                const actionSpan = notificationEl.querySelector('.notification-action');

                textSpan.innerHTML = promo.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                notificationEl.setAttribute('onclick', promo.action);
                
                notificationEl.classList.add('show');
                
                currentPromoIndex = (currentPromoIndex + 1) % promotionList.length;

                setTimeout(() => {
                    notificationEl.classList.remove('show');
                }, promoDisplayDuration);

            }, 500); 
        }
        
        function startPromoRotation() {
            updateFloatingNotification(); 
            setInterval(updateFloatingNotification, promoInterval);
        }


        // --- DỮ LIỆU MUA HÀNG NGẪU NHIÊN (ĐÃ SỬA ĐỔI) ---
        
        const randomUsers = [
            "Anh_Tuan_MMO", "Chi_Linh_HN", "Binh_Duong_VPN", "Minh_Phat_Acc", "Thao_VIP",
            "Dat_Coder", "Khach_Vip_99", "Trader_888", "User_VN_777", "Ngoc_Ruby",
            "Dai_Ka_Acc", "Master_MMO", "Tai_Khoan_Gia_Re", "Pham_Duy_1990", "Hoc_Vien_K",
            "Nhat_Long_Tech", "Phuoc_Loc_MB", "Viet_Anh_Ads", "Global_Farm", "Duy_Tien_IT",
            "Lan_Huong_SEO", "Ky_Thuat_So", "Sieu_Cap_MMO", "Thanh_Nien_IT"
        ];
        
        // [ĐÃ SỬA] Dữ liệu mua hàng ngẫu nhiên (Đã loại bỏ số lượng, thêm giá để kiểm soát xác suất)
        const randomProducts = [
            { name: "TikTok Lite", price: 70000 },
            { name: "Gogo Lite", price: 120000 },
            { name: "VPN Chất lượng", price: 150000 },
            { name: "Proxy Chất lượng", price: 120000 },
            { name: "Gmail Cổ", price: 25000 },
            { name: "TikTok New Reg", price: 5000 },
            { name: "Tele Trust", price: 55000 },
            { name: "Buff Tương tác", price: 50000 },
            
            // Sản phẩm giá trị cao hơn (ít xuất hiện hơn)
            { name: "Tool Auto Reg", price: 499000 },
            { name: "Tiktok Beta", price: 1500000 }, 
            { name: "FB Cổ", price: 1800000 },
            { name: "X Verified", price: 850000 },
            { name: "Unlock Acc", price: 1200000 },
            { name: "Ebook MMO", price: 2500000 },
            { name: "Bot Tương tác Server", price: 3500000 }
        ];

        // [GIỮ NGUYÊN] Hàm hiển thị thông báo mua hàng ngẫu nhiên
        function showRandomPurchaseToast() {
            // 1. Chọn ngẫu nhiên tên người dùng
            const user = randomUsers[Math.floor(Math.random() * randomUsers.length)];
            
            // 2. [LOGIC MỚI] Chọn sản phẩm dựa trên xác suất (giá thấp ưu tiên hơn)
            let productItem;
            let selectedProductIndex;
            let attempt = 0;
            
            // Thử chọn ngẫu nhiên, nếu giá quá cao (trên 500k) và random không trúng xác suất 20%, thì thử lại
            do {
                selectedProductIndex = Math.floor(Math.random() * randomProducts.length);
                productItem = randomProducts[selectedProductIndex];
                attempt++;
                
                // Nếu sản phẩm giá cao (> 500k) và đây không phải lần thử đầu tiên, 
                // xác suất hiển thị sản phẩm giá cao là 20% (Math.random() < 0.2)
                if (productItem.price > 500000 && attempt > 1 && Math.random() > 0.2) {
                    // Tiếp tục lặp (rất khó trúng sản phẩm giá cao)
                } else {
                    break; // Chọn sản phẩm giá thấp hoặc đã trúng 20% xác suất giá cao
                }
            } while (attempt < 10); // Đảm bảo không lặp vô tận (giới hạn 10 lần thử)

            // 3. Tạo thông báo chi tiết (CHỈ CÓ TÊN NGƯỜI DÙNG VÀ SẢN PHẨM)
            // Loại bỏ số lượng trong thông báo
            const message = `✨ **${user}** vừa mua thành công **${productItem.name}**!`;

            // Cập nhật Toast
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.querySelector('#toast-notification .toast-icon');

            // Cập nhật icon và màu sắc cho thông báo mua hàng
            toastIcon.className = 'fa-solid fa-cart-arrow-down toast-icon';
            toastIcon.style.color = 'var(--chat-color)';
            toast.style.backgroundColor = '#fff3e0'; // Nền cam nhạt
            
            toastMessage.innerHTML = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            toast.classList.add('show');

            // Tự động ẩn sau 4 giây
            setTimeout(function(){ 
                toast.classList.remove('show'); 
            }, 4000);
        }

        // [GIỮ NGUYÊN] Hàm tự động lặp lại thông báo ngẫu nhiên (ĐÃ GIẢM TẦN SUẤT)
        function startRandomPurchaseTimer() {
            // Ngẫu nhiên thời gian chờ từ 10000ms (10 giây) đến 20000ms (20 giây)
            const randomDelay = Math.random() * 10000 + 10000; 
            
            setTimeout(() => {
                showRandomPurchaseToast();
                // Lặp lại việc gọi hàm sau khi hiển thị xong
                startRandomPurchaseTimer(); 
            }, randomDelay);
        }

        // --- KHỞI ĐỘNG VÀ CHUYỂN TRANG ---

        // Hàm chuyển đổi nội dung chính (giữ nguyên)
        function showSection(sectionId, clickedElement) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => { section.style.display = 'none'; });
            const selectedSection = document.getElementById(sectionId + '-section');
            if (selectedSection) { selectedSection.style.display = 'block'; }
            const navLinks = document.querySelectorAll('.navbar-item a');
            navLinks.forEach(link => { link.classList.remove('active'); });
            if (clickedElement) { clickedElement.classList.add('active'); }
            
            const title = sectionId.charAt(0).toUpperCase() + sectionId.slice(1);
            document.getElementById('content-title').innerText = 'Nội dung của ' + title;
            document.getElementById('content-text').style.display = 'none'; 

            if (sectionId === 'wallet') {
                const activeTabButton = document.querySelector('.wallet-page .tab-button.active');
                if (activeTabButton) {
                    if (document.getElementById('transactions-history').style.display !== 'none') {
                        renderTransactionHistory();
                    } else if (document.getElementById('purchases-history').style.display !== 'none') {
                        renderPurchaseHistory();
                    }
                } else {
                    renderTransactionHistory();
                }
            } else if (sectionId === 'profile') {
                if (!isUserLoggedIn) {
                    toggleAuthView('register');
                } else {
                    document.getElementById('registration-view').style.display = 'none';
                    document.getElementById('profile-view').style.display = 'block';
                    // GỌI HÀM RENDER KHO ĐỒ KHI VÀO TRANG CÁ NHÂN
                    renderInventory(); 
                }
            }
        }

        // Hàm hiển thị/ẩn khung chat (giữ nguyên)
        function toggleChatWidget(event) {
            event.preventDefault();
            const chatWidget = document.getElementById('chat-widget');
            chatWidget.classList.toggle('show-chat');
            if (chatWidget.classList.contains('show-chat')) {
                document.getElementById('chat-input-text').focus();
            }
        }

        // Hàm xử lý gửi tin nhắn Chat Bot (giữ nguyên)
        function sendChatMessage() {
            const inputField = document.getElementById('chat-input-text');
            const messageText = inputField.value.trim();
            const chatBody = document.getElementById('chat-messages');

            if (messageText !== "") {
                const userMessage = document.createElement('div');
                userMessage.classList.add('message', 'user');
                userMessage.textContent = messageText;
                chatBody.appendChild(userMessage);

                const lowerCaseMessage = messageText.toLowerCase();

                setTimeout(() => {
                    const botMessage = document.createElement('div');
                    botMessage.classList.add('message', 'bot');
                    
                    let botResponse = `<i class="fa-solid fa-robot bot-icon"></i> Xin lỗi, tôi không hiểu câu hỏi này. Bạn vui lòng thử lại bằng các từ khóa như: **mua**, **nạp tiền**, **hỗ trợ**, **bảo hành** hoặc liên hệ qua Telegram nhé.`;

                    if (lowerCaseMessage.includes("mua") || lowerCaseMessage.includes("sản phẩm")) {
                        botResponse = `<i class="fa-solid fa-robot bot-icon"></i> Bạn có thể xem toàn bộ sản phẩm và giá tại mục **Shop** trên thanh menu dưới. Chúng tôi có các loại tài khoản TikTok Lite, Gogo Lite, Proxy/VPN và nhiều hơn nữa!`;
                    } else if (lowerCaseMessage.includes("nạp") || lowerCaseMessage.includes("tiền") || lowerCaseMessage.includes("ví")) {
                         botResponse = `<i class="fa-solid fa-robot bot-icon"></i> Để nạp tiền, bạn vào mục **Ví** (Wallet) trên thanh menu. Chúng tôi hỗ trợ nạp qua Momo và Chuyển khoản Vietcombank với ưu đãi cộng thêm 10% giá trị nạp!`;
                    } else if (lowerCaseMessage.includes("hỗ trợ") || lowerCaseMessage.includes("gặp sự cố")) {
                         botResponse = `<i class="fa-solid fa-robot bot-icon"></i> Mọi vấn đề kỹ thuật hoặc cần hỗ trợ gấp, vui lòng bấm vào nút **Hỗ trợ** (biểu tượng tai nghe) ở góc trái để chat trực tiếp qua **Telegram** với nhân viên.`;
                    } else if (lowerCaseMessage.includes("bảo hành") || lowerCaseMessage.includes("check acc")) {
                         botResponse = `<i class="fa-solid fa-robot bot-icon"></i> Chính sách bảo hành tùy thuộc vào sản phẩm. Ví dụ:
* **Tài khoản Lite/Gogo:** Kiểm tra trong 1 giờ.
* **Tiktok Beta:** Bảo hành 7 ngày đổi mới (đảm bảo không bị tước quyền kiếm tiền lúc bàn giao).
Vui lòng liên hệ Telegram nếu tài khoản bị khóa sau khi mua.`;
                    }

                    botMessage.innerHTML = botResponse.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    chatBody.appendChild(botMessage);

                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 1000); 

                inputField.value = '';
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }
        
        // Hàm gửi tin nhắn bằng phím Enter (giữ nguyên)
        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
                event.preventDefault();
            }
        }
        
        // Tự động kích hoạt Menu khi tải trang
        document.addEventListener('DOMContentLoaded', () => {
            if (userAuthKey) {
                loadUserData(userAuthKey);
            }
            
            const defaultSection = document.querySelector('.navbar-item a');
            if (defaultSection) {
                defaultSection.click();
            }
            
            setRating(5); 
            
            createSalesTickerContent();
            
            // ⭐️ BẬT TÍNH NĂNG MUA HÀNG NGẪU NHIÊN
            startRandomPurchaseTimer(); 
            
            // ⭐️ BẬT TÍNH NĂNG PROMO LUÂN PHIÊN
            startPromoRotation();
            
            updateAllDisplay();
            
            // ********** HIỂN THỊ WELCOME MODAL KHI TẢI TRANG **********
            setTimeout(showWelcomeModal, 500); 
            // *****************************************************************
        });
        
        // Đóng modal khi click ra ngoài (giữ nguyên)
        window.onclick = function(event) {
            const modalPurchase = document.getElementById('purchase-modal');
            const modalTopup = document.getElementById('topup-modal');
            const modalServer = document.getElementById('server-detail-modal'); 
            const modalWelcome = document.getElementById('welcome-modal');
            
            if (event.target === modalPurchase) {
                closeModal();
            }
             if (event.target === modalTopup) {
                closeTopUpModal();
            }
            if (event.target === modalServer) { 
                closeServerDetailModal();
            }
             if (event.target === modalWelcome) {
                // Chỉ đóng nếu click vào nền mờ, không phải nội dung
                // Tuy nhiên, vì nút ĐÃ HIỂU đã có, ta có thể bỏ qua việc tự động đóng để đảm bảo người dùng đọc kỹ
                // hideWelcomeModal(); // Bỏ comment nếu muốn tự động đóng khi click nền
            }
        }
        
        // CHỐNG LỖI ZOOM MÀN HÌNH KHI GÕ TRÊN MOBILE (giữ nguyên)
        document.addEventListener('DOMContentLoaded', function() {
            var inputs = document.querySelectorAll('#chat-input-text, #topup-amount, #quantity, #reg-email-phone, #reg-password, #reg-confirm-password, #reg-username, #login-email-phone, #login-password');
            inputs.forEach(function(input) {
                input.addEventListener('focus', function(e) {
                    var viewPortTag = document.querySelector('meta[name="viewport"]');
                    if (viewPortTag) {
                        viewPortTag.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                    }
                });
                input.addEventListener('blur', function(e) {
                    var viewPortTag = document.querySelector('meta[name="viewport"]');
                    if (viewPortTag) {
                        viewPortTag.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'); 
                    }
                });
            });
        });
    </script>

</body>
</html>
